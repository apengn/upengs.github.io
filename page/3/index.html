<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Peng">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Peng">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Peng">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/">





  <title>Peng</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Peng</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Welcome to my Blogs!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/27/redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pengemailcom@163.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Peng">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/27/redis/" itemprop="url">redis</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-27T11:49:23+08:00">
                2019-02-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="github-com-garyburd-redigo-redis"><a href="#github-com-garyburd-redigo-redis" class="headerlink" title="github.com/garyburd/redigo/redis"></a>github.com/garyburd/redigo/redis</h3><h4 id="遇到的坑："><a href="#遇到的坑：" class="headerlink" title="遇到的坑："></a>遇到的坑：</h4><h4 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h4><p>Connections支持Receive方法的一个并发调用者和Send和Flush方法的一个并发调用者。不支持其他并发，包括对Do和Close方法的并发调用。<br>要完全并发访问Redis，请使用线程安全池从goroutine中获取，使用和释放连接。从池返回的连接具有上一段中描述的并发限制。</p>
<h4 id="清空redis-数据"><a href="#清空redis-数据" class="headerlink" title="清空redis 数据"></a>清空redis 数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushall</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/26/git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pengemailcom@163.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Peng">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/26/git/" itemprop="url">git</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-26T22:02:36+08:00">
                2019-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Git</p>
<p>新建分支：v1.1.1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch v1.1.1</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -b v1.1.1</span><br></pre></td></tr></table></figure>
<p>//新建分支并切换到新建分支<br>home@DESKTOP-S967PDA MINGW64 /f/gitPractise/gitDemo (v1.1.2)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b v1.1.5 v1.1.2</span><br></pre></td></tr></table></figure>
<p>切换分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout v1.1.1</span><br></pre></td></tr></table></figure>
<p>//把分支push 到remote</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push orign v1.1.1</span><br></pre></td></tr></table></figure>
<p>//修改branch 的名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -m v1.1.1 v1.1.2</span><br></pre></td></tr></table></figure>
<p>//删除branch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --delete v1.1.1</span><br></pre></td></tr></table></figure>
<p>添加文件到git<br>将当前目录下所有变化的文件，放入暂存区</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git add ./</span><br></pre></td></tr></table></figure>
<p>//参数表示只添加暂存区已有的文件（包括删除操作），但不添加新增的文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add -u</span><br></pre></td></tr></table></figure>
<p>//查看本地branch 分支</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git branch </span><br><span class="line"></span><br><span class="line">git branch -v</span><br></pre></td></tr></table></figure>
<p>//查看本地和远程的分支</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -a</span><br></pre></td></tr></table></figure>
<p>//查看 远程remote 分支</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -r</span><br></pre></td></tr></table></figure>
<p>//比较文件差异</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff</span><br></pre></td></tr></table></figure>
<p>//删除分支(前提条件是该分支没有被合并)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -d v1.1.1</span><br></pre></td></tr></table></figure>
<p>//强制删除一个分支，不管该分支有没有被合并</p>
<p>git branch -D v1.1.1</p>
<p>//查看merge的情况<br>git branch –merged</p>
<p>将工作区制定的文件还原到上次commit的状态<br>git checkout xxx.txt</p>
<p>//切换到某个tag</p>
<p>git checkout tags/1.1.4<br>或<br>git checkout 1.1.4</p>
<p>//命令”复制”一个提交节点并在当前分支做一次完全一样的新提交。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git cherry-pick xxxxx</span><br></pre></td></tr></table></figure>
<p>//根据一个树对象，生成新的commit对象。</p>
<p>git commit-tree 16e19f -m “First commit”</p>
<p>查看工作区与暂存区的差异</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br></pre></td></tr></table></figure>
<p> 查看某个文件的工作区与暂存区的差异</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff file.txt</span><br></pre></td></tr></table></figure>
<p>查看暂存区与当前 commit 的差异</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --cached</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>查看两个commit的差异</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff &lt;commitBefore&gt; &lt;commitAfter</span><br></pre></td></tr></table></figure>
<blockquote>
</blockquote>
<p> 查看暂存区与仓库区的差异</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --cached</span><br></pre></td></tr></table></figure>
<p>查看工作区与上一次commit之间的差异<br>即如果执行 git commit -a，将提交的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff HEAD</span><br></pre></td></tr></table></figure>
<p>查看工作区与某个 commit 的差异</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff &lt;commit&gt;</span><br></pre></td></tr></table></figure>
<p>显示两次提交之间的差异</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff [first-branch]...[second-branch]</span><br></pre></td></tr></table></figure>
<p>查看工作区与当前分支上一次提交的差异，但是局限于test文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff HEAD -- ./test</span><br></pre></td></tr></table></figure>
<p>查看当前分支上一次提交与上上一次提交之间的差异</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff HEAD -- ./test</span><br></pre></td></tr></table></figure>
<p>生成patch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git format-patch master --stdout &gt; mypatch.patch</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> 查看topic分支与master分支最新提交之间的差异</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff topic master</span><br></pre></td></tr></table></figure>
<p> 与上一条命令相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff topic..master</span><br></pre></td></tr></table></figure>
<p>查看自从topic分支建立以后，master分支发生的变化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff topic...master</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>命令将当前目录转为git仓库。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>
<p>命令按照提交时间从最晚到最早的顺序，列出所有 commit。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure>
<p>git remote<br>为远程仓库添加别名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">it remote add john git@github.com:johnsomeone/someproject.git</span><br></pre></td></tr></table></figure>
<p> 显示所有的远程主机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote -v</span><br></pre></td></tr></table></figure>
<p> 列出某个主机的详细信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote show name</span><br></pre></td></tr></table></figure>
<p>git revert<br>git revert命令用于撤销commit。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert &lt;commitID&gt;</span><br></pre></td></tr></table></figure>
<p>git rm<br>git rm命令用于删除文件。</p>
<p>解除追踪某个文件，即该文件已被git add添加，然后抵消这个操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git rm --cached &lt;fileName&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git show</span><br><span class="line">git show命令用于查看commit的内容</span><br><span class="line"></span><br><span class="line"># 输出某次提交的元数据和内容变化</span><br><span class="line">$ git show [commit]</span><br><span class="line">$ git show 12a86bc38 # By revision</span><br><span class="line">$ git show v1.0.1 # By tag</span><br><span class="line">$ git show feature132 # By branch name</span><br><span class="line">$ git show 12a86bc38^ # Parent of a commit</span><br><span class="line">$ git show 12a86bc38~2 # Grandparent of a commit</span><br><span class="line">$ git show feature132@&#123;yesterday&#125; # Time relative</span><br><span class="line">$ git show feature132@&#123;2.hours.ago&#125; # Time relative</span><br></pre></td></tr></table></figure>
<p>git merge master<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">home@DESKTOP-S967PDA MINGW64 /f/gitPractise/gitDemo (v1.1.5)</span><br><span class="line">$ git merge master</span><br><span class="line">Already up-to-date.</span><br><span class="line"></span><br><span class="line">home@DESKTOP-S967PDA MINGW64 /f/gitPractise/gitDemo (v1.1.5)</span><br><span class="line">$ git checkout v1.1.5</span><br><span class="line">Already on &apos;v1.1.5&apos;</span><br><span class="line"></span><br><span class="line">home@DESKTOP-S967PDA MINGW64 /f/gitPractise/gitDemo (v1.1.5)</span><br><span class="line">$ git checkout master</span><br><span class="line">Switched to branch &apos;master&apos;</span><br><span class="line">Your branch is up-to-date with &apos;origin/master&apos;.</span><br><span class="line"></span><br><span class="line">home@DESKTOP-S967PDA MINGW64 /f/gitPractise/gitDemo (master)</span><br><span class="line">$ git merge v1.1.5</span><br><span class="line">Updating 891e496..f6a3810</span><br><span class="line">Fast-forward</span><br><span class="line"> dome.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"></span><br><span class="line">home@DESKTOP-S967PDA MINGW64 /f/gitPractise/gitDemo (master)</span><br><span class="line">$ cat dome.txt</span><br><span class="line">gjkdsjsdjfjjgjksjdjfkdsjfsjffjkdsjfsjkfjksjfjsdjjsf</span><br></pre></td></tr></table></figure></p>
<p>查看提交日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git log --pretty=oneline</span><br><span class="line">1094adb7b9b3807259d8cb349e7df1d4d6477073 (HEAD -&gt; master) append GPL</span><br></pre></td></tr></table></figure>
<p>回退版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard 1094adb7b9b3807259d8cb349e7df1d4d6477073</span><br></pre></td></tr></table></figure>
<p>查看远程分支<br>加上-a参数可以查看远程分支，远程分支会用红色表示出来（如果你开了颜色支持的话）：<br>$ git branch -a<br>  master<br>  remote<br>  tungway<br>  v1.52</p>
<ul>
<li>zrong<br>remotes/origin/master<br>remotes/origin/tungway<br>remotes/origin/v1.52<br>remotes/origin/zrong<br>删除远程分支和tag<br>在Git v1.7.0 之后，可以使用这种语法删除远程分支：</li>
</ul>
<p>1<br>$ git push origin –delete <branchname><br>删除tag这么用：</branchname></p>
<p>1<br>git push origin –delete tag <tagname><br>否则，可以使用这种语法，推送一个空分支到远程分支，其实就相当于删除远程分支：</tagname></p>
<p>1<br>git push origin :<branchname><br>这是删除tag的方法，推送一个空tag到远程tag：</branchname></p>
<p>$ git remote show origin</p>
<ul>
<li>remote origin<br>Fetch URL: <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:xxx/xxx.git<br>Push  URL: <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:xxx/xxx.git<br>HEAD branch: master<br>Remote branches:<br>  master                 tracked<br>  refs/remotes/origin/b1 stale (use ‘git remote prune’ to remove)<br>Local branch configured for ‘git pull’:<br>  master merges with remote master<br>Local ref configured for ‘git push’:<br>  master pushes to master (up to date)<br>这时候能够看到b1是stale的，使用 git remote prune origin 可以将其从本地版本库中去除。</li>
</ul>
<p>更简单的方法是使用这个命令，它在fetch之后删除掉没有与远程分支对应的本地分支：</p>
<p>1<br>git fetch -p<br>重命名远程分支<br>在git中重命名远程分支，其实就是先删除远程分支，然后重命名本地分支，再重新提交一个远程分支。</p>
<p>例如下面的例子中，我需要把 devel 分支重命名为 develop 分支：</p>
<p>$ git branch -av</p>
<ul>
<li>devel                             752bb84 Merge pull request #158 from Gwill/devel<br>master                            53b27b8 Merge pull request #138 from tdlrobin/master<br>zrong                             2ae98d8 modify CCFileUtils, export getFileData<br>remotes/origin/HEAD               -&gt; origin/master<br>remotes/origin/add_build_script   d4a8c4f Merge branch ‘master’ into add_build_script<br>remotes/origin/devel              752bb84 Merge pull request #158 from Gwill/devel<br>remotes/origin/devel_qt51         62208f1 update .gitignore<br>remotes/origin/master             53b27b8 Merge pull request #138 from tdlrobin/master<br>remotes/origin/zrong              2ae98d8 modify CCFileUtils, export getFileData<br>删除远程分支：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push --delete origin devel</span><br></pre></td></tr></table></figure>
<p>To <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:zrong/quick-cocos2d-x.git</p>
<ul>
<li>[deleted]         devel<br>重命名本地分支：</li>
</ul>
<p>1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -m devel develop</span><br></pre></td></tr></table></figure>
<p>推送本地分支：</p>
<p>$ git push origin develop<br>Counting objects: 92, done.<br>Delta compression using up to 4 threads.<br>Compressing objects: 100% (48/48), done.<br>Writing objects: 100% (58/58), 1.38 MiB, done.<br>Total 58 (delta 34), reused 12 (delta 5)<br>To <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:zrong/quick-cocos2d-x.git</p>
<ul>
<li>[new branch]      develop -&gt; develop<br>然而，在 github 上操作的时候，我在删除远程分支时碰到这个错误：</li>
</ul>
<p>$ git push –delete origin devel<br>remote: error: refusing to delete the current branch: refs/heads/devel<br>To <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:zrong/quick-cocos2d-x.git<br> ! [remote rejected] devel (deletion of the current branch prohibited)<br>error: failed to push some refs to <a href="mailto:&#39;git@github.com" target="_blank" rel="noopener">&#39;git@github.com</a>:zrong/quick-cocos2d-x.git’<br>这是由于在 github 中，devel 是项目的默认分支。要解决此问题，这样操作：</p>
<p>进入 github 中该项目的 Settings 页面；<br>设置 Default Branch 为其他的分支（例如 master）；<br>重新执行删除远程分支命令。<br>把本地tag推送到远程<br>1<br>git push –tags<br>获取远程tag<br>1<br>git fetch origin tag <tagname></tagname></p>
<p>保存当前修改在缓存中，不可见</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash save &quot;worker&quot;</span><br></pre></td></tr></table></figure>
<p>把当前保存在缓存的显示出来，可见</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash pop</span><br></pre></td></tr></table></figure>
<h2 id="Git-命令行-使用-Tag-标记你的代码"><a href="#Git-命令行-使用-Tag-标记你的代码" class="headerlink" title="Git-命令行-使用 Tag 标记你的代码"></a>Git-命令行-使用 Tag 标记你的代码</h2><p>参考<br><a href="https://blog.csdn.net/qq_32452623/article/details/73949509" target="_blank" rel="noopener">https://blog.csdn.net/qq_32452623/article/details/73949509</a></p>
<p><a href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/001376951885068a0ac7d81c3a64912b35a59b58a1d926b000" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/001376951885068a0ac7d81c3a64912b35a59b58a1d926b000</a></p>
<p>命令git push origin <tagname>可以推送一个本地标签；</tagname></p>
<p>命令git push origin –tags可以推送全部未推送过的本地标签；</p>
<p>命令git tag -d <tagname>可以删除一个本地标签；</tagname></p>
<p>命令git push origin :refs/tags/<tagname>可以删除一个远程标签。</tagname></p>
<p>同步remote branch to local<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -p</span><br></pre></td></tr></table></figure></p>
<h2 id="对单次提交的每个文件都添加注释"><a href="#对单次提交的每个文件都添加注释" class="headerlink" title="对单次提交的每个文件都添加注释"></a>对单次提交的每个文件都添加注释</h2><p>可以单独add/commit，然后最后一起push。</p>
<p>如有两个文件A.md和B.md需要push， 可以如下操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git add A.md</span><br><span class="line">git commit -m &quot;add A&quot;</span><br><span class="line">git add B.md</span><br><span class="line">git commit -m &quot;add B&quot;</span><br><span class="line">git push.....</span><br></pre></td></tr></table></figure>
<p>git squash</p>
<p>`Git进阶命令讲解：squash,fixup,stash<br>2014-05-21 GitHub不完全装B指南</p>
<p>@董林 希望我讲一下这三个命令，我看了一下，这三个命令虽然平时用得较少，但是在特定的情况下还是非常有用的，所以我就详细讲解一下。</p>
<p>注意：下面的内容可能有点难，大家要集中精力了。</p>
<p>一、squash</p>
<p>squash准确来说并不是一个命令，而是rebase命令的一个功能。squash的作用很简单——合并多个commit。</p>
<p>来看用法：</p>
<p>git rebase -i HEAD~5<br>-i的意思是使用“交互式”的修改方法。加了这个参数之后，Git会把所有commit列出来，让你进行一些修改，修改完成之后会根据你的修改来rebase。HEAD-5的意思是只修改最近的5个commit。</p>
<p>运行完这条命令之后，会进入一个编辑界面，大概是这样的：</p>
<p>pick awe Add sth<br>pick add Have a rest<br>pick xxc Wow<br>pick cxz Yeah<br>pick dsa Finish it<br>可以看到一共有5行，这就是最近的5个commit以及它们的信息。</p>
<p>假设我们现在想把它们合并成一个commit，要怎么做呢？直接看例子：</p>
<p>pick awe Add sth<br>squash add Have a rest<br>squash xxc Wow<br>squash cxz Yeah<br>squash dsa Finish it</p>
<p>我们把后4个commit的pick都改成了squash，修改完成之后保存退出，Git就会继续执行rebase命令了。执行完可以看一下结果，最后的4条commit都消失了，它们都被合并到了倒数第5条中。</p>
<p>现在大家应该理解了，squash的作用就是把当前commit向前合并，一直合并到pick为止。</p>
<p>rebase完成之后大家可以看一下最后一个commit的信息，里面会包含rebase之前最后5条的所有commit信息，也就是诸如“Add sth Have a rest Wow Yeah Finish it”这些东西。</p>
<p>二、fixup</p>
<p>fixup和squash非常类似，把pick修改成fixup，同样会向前合并到pick，唯一的区别就是，fixup会忽略当前commit的信息，只会应用修改。</p>
<p>怎么理解呢？还用上面的例子说，假设我们使用fixup代替squash：</p>
<p>pick awe Add sth<br>fixup add Have a rest<br>fixup xxc Wow<br>fixup cxz Yeah<br>fixup dsa Finish it</p>
<p>保存退出之后，等Git执行完rebase我们查看一下最后一条commit的信息，会发现里面只有“Add sth”，另外四条commit的信息比如“Have a rest”都没有了。</p>
<p>三、stash</p>
<p>stash是一条Git命令，作用非常简单——保存当前状态。</p>
<p>假设我们现在正在进行工作，修改了一些文件，添加了一些文件。这时我们突然想切换到另一个分支工作，但是又不想commit当前的修改（可能因为它们还不能运行），那该怎么办呢？答案就是stash。</p>
<p>来看命令——git stash</p>
<p>执行完命令之后，Git会把当前的状态保存，同时清理当前目录。我们可以运行一下 git status，会发现当前目录没有任何修改。这时我们就可以放心地切换分支工作了。</p>
<p>等其他工作结束，想继续之前的工作时，可以运行 git stash apply，Git会把保存的状态复原。</p>
<p>stash可以运行多次，会保存多个状态，可以运行 git stash list 来查看所有状态。运行 git stash apply 会默认复原到最近一次保存的状态，如果想指定复原状态可以使用 git stash apply stash@{2} ，这条命令会复原到 stash@{0} 状态。</p>
<p>运行 apply 之后，被复原的状态并不会自动删除，仍然在 stash list 当中。可以运行 git stash drop stash@{0} 来删除 stash@{0} 状态，或者使用 git stash pop 命令来代替 git stash apply 命令，这样复原之后会自动删除被复原状态。</p>
<p>如果 apply 的时候出现冲突（因为你 stash 之后对文件进行了修改），那么需要手动解决冲突。</p>
<p>最后需要注意一点：stash 复原的时候默认不复原 staged 文件，也就是说如果你运行过 add 命令，使用 git status 查看的话文件应当处于 staged 状态，但是如果你 stash 并复原再看，那个文件的状态又变回 unstaged 了。解决办法就是运行 git stash apply 命令时加上 –index 参数：git stash apply –index，这样就可以完全恢复到 stash 之前的状态。<code></code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">修改branch 的名字</span><br></pre></td></tr></table></figure>
<p>git branch -M oldbranch newbranch<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">git stash 可用来暂存当前正在进行的工作， 比如想pull 最新代码， 又不想加新commit， 或者另外一种情况，为了fix 一个紧急的bug,  先stash, 使返回到自己上一个commit, 改完bug之后再stash pop, 继续原来的工作。</span><br><span class="line">基础命令：</span><br><span class="line">$git stash</span><br><span class="line">$do some work</span><br><span class="line">$git stash pop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">进阶：</span><br><span class="line"></span><br><span class="line">git stash save &quot;work in progress for foo feature&quot;</span><br><span class="line"></span><br><span class="line">当你多次使用’git stash’命令后，你的栈里将充满了未提交的代码，这时候你会对将哪个版本应用回来有些困惑，</span><br><span class="line"></span><br><span class="line">’git stash list’ 命令可以将当前的Git栈信息打印出来，你只需要将找到对应的版本号，例如使用’git stash apply stash@&#123;1&#125;’就可以将你指定版本号为stash@&#123;1&#125;的工作取出来，当你将所有的栈都应用回来的时候，可以使用’git stash clear’来将栈清空。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git stash          # save uncommitted changes</span><br><span class="line"># pull, edit, etc.</span><br><span class="line">git stash list     # list stashed changes in this git</span><br><span class="line">git show stash@&#123;0&#125; # see the last stash </span><br><span class="line">git stash pop      # apply last stash and remove it from the list</span><br><span class="line"></span><br><span class="line">git stash --help   # for more info</span><br><span class="line"></span><br><span class="line">git checkout bbb</span><br><span class="line">git rebase master   //   把master的代码弄到bbb上(前提条件是文件不冲突，tree进行改变)</span><br><span class="line"></span><br><span class="line">git checkout --theirs xxx    把xxx  分支的内容放到bbb上</span><br><span class="line"></span><br><span class="line">git checkout --ours xxx  类似</span><br></pre></td></tr></table></figure></p>
<h3 id="git删除某个commit"><a href="#git删除某个commit" class="headerlink" title="git删除某个commit"></a>git删除某个commit</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.git log 获取commit信息  </span><br><span class="line"></span><br><span class="line">2.git rebase -i (commit-id)</span><br><span class="line"> </span><br><span class="line">commit-id 为要删除的commit的下一个commit号 </span><br><span class="line"></span><br><span class="line">3.编辑文件，将要删除的commit之前的单词改为drop </span><br><span class="line"></span><br><span class="line">4.保存文件退出大功告成 </span><br><span class="line"></span><br><span class="line">5.git log查看</span><br><span class="line"></span><br><span class="line">git push origin master –force</span><br><span class="line">```i</span><br><span class="line">使用--amend 修改 author</span><br></pre></td></tr></table></figure>
<p> git commit –amend –author=‘xxx <a href="mailto:&#120;&#120;&#x78;&#x78;&#64;&#120;&#120;&#x78;&#x2e;&#x78;&#x78;&#120;" target="_blank" rel="noopener">&#120;&#120;&#x78;&#x78;&#64;&#120;&#120;&#x78;&#x2e;&#x78;&#x78;&#120;</a><br><code>`</code></p>
<p><a href="https://blog.csdn.net/mocoe/article/details/84344411" target="_blank" rel="noopener">https://blog.csdn.net/mocoe/article/details/84344411</a></p>
<p><a href="https://www.jianshu.com/p/5b3166c855b2" target="_blank" rel="noopener">https://www.jianshu.com/p/5b3166c855b2</a></p>
<p>// 把另一个分支structure2的代码merge  到newbr 上，不包括commit<br>git checkout master<br>git checout -b newbr<br>git merge —squash —no-commit structure2<br>git add vendor<br>git commit -m “add vendor”<br>git add .<br>git commit -a -m “commit message”  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/26/linux-cmd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pengemailcom@163.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Peng">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/26/linux-cmd/" itemprop="url">linux_cmd</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-26T22:02:28+08:00">
                2019-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ps -ef |grep {fillter}<br>kill -9 {pid}<br>mkdir -p roles/{common,install}/{handlers,files,meta,tasks,templates,vars<br>ss -tunlp|grep  7777<br>ss -alnp |grep 7777<br>netstat -tunlp|grep 777<br>netstat -alnp|grep 7777</p>
<h2 id="lsof-i-tcp-777"><a href="#lsof-i-tcp-777" class="headerlink" title="lsof -i tcp:777"></a>lsof -i tcp:777</h2><p>chmod<br>u 代表用户.<br>g 代表用户组.<br>o 代表其他.<br>a 代表所有.</p>
<p>这意味着chmod u+x somefile 只授予这个文件的所属者执行的权限<br>而 chmod +x somefile 和 chmod a+x somefile 是一样的 </p>
<p>// 实现免密登陆<br>ssh-copy-id root@hostip</p>
<h3 id="压缩文件"><a href="#压缩文件" class="headerlink" title="压缩文件"></a>压缩文件</h3><p>tar -czvf wisecloud-ingress-controller.gz ./wisecloud-ingress-controller</p>
<h3 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h3><p>tar -zxvf wisecloud-ingress-controller.gz -o ./</p>
<p>docker run –rm -it golang:1.10 sh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">grep -A 50</span><br><span class="line"></span><br><span class="line">grep -B 50</span><br><span class="line">``</span><br><span class="line"></span><br><span class="line">kcc get pod |grep orchestration | awk &apos;&#123;print $1&#125;&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">screen 使用</span><br><span class="line">screen </span><br><span class="line">执行逻辑</span><br><span class="line"></span><br><span class="line">screen -list </span><br><span class="line"></span><br><span class="line">screen -r </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">screen -r 30719.pts-4.dev-10</span><br><span class="line">There is a screen on:</span><br><span class="line">	30719.pts-4.dev-10	(Attached)</span><br><span class="line">There is no screen to be resumed matching 30719.pts-4.dev-10.</span><br><span class="line">[root@dev-10 ~]# screen -r 30719.pts-4.dev-</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">netstat -an|wc -l   wc 统计行号</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl get -o template node/dev-9 --template=&#123;&#123;.spec&#125;&#125;</span><br><span class="line"></span><br><span class="line">linux 部分快捷键</span><br><span class="line">1. Tab</span><br><span class="line">这是你不能没有的 Linux 快捷键。它将节省你 Linux 命令行中的大量时间。</span><br><span class="line"></span><br><span class="line">只需要输入一个命令，文件名，目录名甚至是命令选项的开头，并敲击 tab 键。 它将自动完成你输入的内容，或为你显示全部可能的结果。</span><br><span class="line"></span><br><span class="line">如果你只记一个快捷键，这将是必选的一个。</span><br><span class="line"></span><br><span class="line">2. Ctrl + C</span><br><span class="line">这些是为了在终端上中断命令或进程该按的键。它将立刻终止运行的程序。</span><br><span class="line"></span><br><span class="line">如果你想要停止使用一个正在后台运行的程序，只需按下这对组合键。</span><br><span class="line"></span><br><span class="line">3. Ctrl + Z</span><br><span class="line">该快捷键将正在运行的程序送到后台。 通常，你可以在使用 &amp; 选项运行程序前之完成该操作， 但是如果你忘记使用选项运行程序，就使用这对组合键。</span><br><span class="line"></span><br><span class="line">4. Ctrl + D</span><br><span class="line">这对键盘快捷键将使你退出当前终端。如果你使用 SSH 连接，它将会关闭。 如果你直接使用一个终端，该应用将会立刻关闭。</span><br><span class="line"></span><br><span class="line">把它当成“退出”命令。</span><br><span class="line"></span><br><span class="line">5. Ctrl + L</span><br><span class="line">你怎么清空你的终端屏幕？我猜是用 clear 命令。</span><br><span class="line"></span><br><span class="line">你可以使用 Ctrl+L 清空终端，代替输入 C-L-E-A-R。得心应手，不是吗？</span><br><span class="line"></span><br><span class="line">6. Ctrl + A</span><br><span class="line">该快捷键将移动光标到所在行首。</span><br><span class="line"></span><br><span class="line">假设你在终端输入了一个很长的命令或路径，并且你想要回到它的开头， 使用方向键移动光标将花费大量时间。注意你无法使用鼠标移动光标到行首。</span><br><span class="line"></span><br><span class="line">这是 Ctrl+A 节省时间的地方。</span><br><span class="line"></span><br><span class="line">7. Ctrl + E</span><br><span class="line">这对快捷键与 Ctrl+A 相反。 Ctrl+A 送光标到行首，反之 Ctrl+E 移动光标到行尾。</span><br><span class="line"></span><br><span class="line">8. Ctrl + U</span><br><span class="line">输入了错误的命令？ 代替用退格键来丢弃当前命令，使用 Linux 终端中的 Ctrl+U 快捷键。 该快捷键会擦除从当前光标位置到行首的全部内容。</span><br><span class="line"></span><br><span class="line">9. Ctrl + K</span><br><span class="line">这对和 Ctrl+U 快捷键有点像。 唯一的不同在于不是行首，它擦除的是从当前光标位置到行尾的全部内容。</span><br><span class="line"></span><br><span class="line">10. Ctrl + W</span><br><span class="line">你刚才了解了擦除到行首和行尾的文本。 但如果你只需要删除一个单词呢？使用 Ctrl+W 快捷键。</span><br><span class="line"></span><br><span class="line">使用 Ctrl+W 快捷键，你可以擦除光标位置前的单词。 如果光标在一个单词本身上，它将擦除从光标位置到词首的全部字母。</span><br><span class="line"></span><br><span class="line">最好的方法是用它移动光标到要删除单词后的一个空格上， 然后使用 Ctrl+W 键盘快捷键。</span><br><span class="line"></span><br><span class="line">11. Ctrl + Y</span><br><span class="line">这将粘贴使用 Ctrl+W，Ctrl+U 和 Ctrl+K 快捷键擦除的文本。 如果你删除了错误的文本或需要在某处使用已擦除的文本，这将派上用场。</span><br><span class="line"></span><br><span class="line">12. Ctrl + P</span><br><span class="line">你可以使用该快捷键来查看上一个命令。 你可以反复按该键来返回到历史命令。 在很多终端里，使用 PgUp 键来实现相同的功能。</span><br><span class="line"></span><br><span class="line">13. Ctrl + N</span><br><span class="line">你可以结合 Ctrl+P 使用该快捷键。Ctrl+N 显示下一个命令。 如果使用 Ctrl+P 查看上一条命令，你可以使用 Ctrl+N 来回导航。 许多终端都把此快捷键映射到 PgDn 键。</span><br><span class="line"></span><br><span class="line">14. Ctrl + R</span><br><span class="line">你可以使用该快捷键来搜索历史命令。</span><br></pre></td></tr></table></figure></p>
<p>通过m命令。讲光标放在你要移动的行，输入:m +1向下移动一行，输入:m -2向上移动一行。</p>
<p>面的命令设置最低空闲内存，立即生效，但系统重启会失效。永久生效则要写到配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/sysctl.conf</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl set vm.min_free_kbytes=1024000</span><br></pre></td></tr></table></figure>
<p>ESC + f– 向右移动一个单词，MAC下建议用ALT + →<br>ESC + b– 向左移动一个单词，MAC下建议用ALT + ←</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/26/helm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pengemailcom@163.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Peng">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/26/helm/" itemprop="url">helm</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-26T18:42:41+08:00">
                2019-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="helm-注意事项"><a href="#helm-注意事项" class="headerlink" title="helm  注意事项"></a>helm  注意事项</h4><p>helm  install chats 与repo 有关</p>
<p>helm 获取删除chats release 只与config 有关</p>
<p>helm repo add  可以 重复，第二次添加类似update<br>helm create wp<br>helm package wp –debug</p>
<h3 id="启动helm-repo-serve"><a href="#启动helm-repo-serve" class="headerlink" title="启动helm repo  serve"></a>启动helm repo  serve</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./helm serve --address 0.0.0.0:8879 &amp;</span><br></pre></td></tr></table></figure>
<h3 id="通过harbor-启动helm-repo"><a href="#通过harbor-启动helm-repo" class="headerlink" title="通过harbor 启动helm repo"></a>通过harbor 启动helm repo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./install.sh   --with-clair --with-chartmuseum</span><br></pre></td></tr></table></figure>
<h3 id="添加harbor-repo-需要密码"><a href="#添加harbor-repo-需要密码" class="headerlink" title="添加harbor repo  需要密码"></a>添加harbor repo  需要密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo add --username=admin --password=Passw0rd myrepo https://xx.xx.xx.xx/chartrepo</span><br></pre></td></tr></table></figure>
<h3 id="添加私有特定仓库-公有的无需密码"><a href="#添加私有特定仓库-公有的无需密码" class="headerlink" title="添加私有特定仓库  公有的无需密码"></a>添加私有特定仓库  公有的无需密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo add --username=admin --password=Passw0rd myrepo https://xx.xx.xx.xx/chartrepo/myproject</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/26/fluentd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pengemailcom@163.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Peng">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/26/fluentd/" itemprop="url">容器化日志收集方案-EFK</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-26T12:12:53+08:00">
                2019-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文将描述如何使用<br>elasticsearch、<br>fluentd 、<br>kibana构建容器化日志收集系统</p>
<h3 id="介绍："><a href="#介绍：" class="headerlink" title="介绍："></a>介绍：</h3><h6 id="elasticsearch："><a href="#elasticsearch：" class="headerlink" title="elasticsearch："></a>elasticsearch：</h6><ul>
<li><p>一个分布式的实时文档存储，每个字段 可以被索引与搜索</p>
</li>
<li><p>一个分布式实时分析搜索引擎</p>
</li>
<li><p>能胜任上百个服务节点的扩展，并支持 PB 级别的结构化或者非结构化数据</p>
</li>
</ul>
<h6 id="fluentd"><a href="#fluentd" class="headerlink" title="fluentd:"></a>fluentd:</h6><p>是日志收集系统，通过丰富的插件，可以收集来自于各种系统或应用的日志，然后根据用户定义将日志做分类处理。 </p>
<h6 id="kibana"><a href="#kibana" class="headerlink" title="kibana:"></a>kibana:</h6><p>是一个针对Elasticsearch的开源分析及可视化平台，用来搜索、查看交互存储在Elasticsearch索引中的数据。 </p>
<h6 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka:"></a>Kafka:</h6><p>是分布式的、可分区的、可复制的消息系统。它提供了普通消息系统的功能，但具有自己独特的设计</p>
<p>Kafka将消息以topic为单位进行归纳。<br>将向Kafka topic发布消息的程序成为producers.<br>将预订topics并消费消息的程序成为consumer.</p>
<h2 id="如何安装"><a href="#如何安装" class="headerlink" title="如何安装"></a>如何安装</h2><ul>
<li><h5 id="安装kafka-zookeeper"><a href="#安装kafka-zookeeper" class="headerlink" title="安装kafka+zookeeper"></a>安装kafka+zookeeper</h5></li>
</ul>
<p>参考：<a href="https://hub.docker.com/r/wurstmeister/kafka/" target="_blank" rel="noopener">https://hub.docker.com/r/wurstmeister/kafka/</a></p>
<ul>
<li><h5 id="安装elasticsearch-kibana"><a href="#安装elasticsearch-kibana" class="headerlink" title="安装elasticsearch+kibana:"></a>安装elasticsearch+kibana:</h5></li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -v "$PWD/esdata":/usr/share/elasticsearch/data -p <span class="number">9200</span>:<span class="number">9200</span>  elasticsearch</span><br><span class="line">docker run --name kibana -e ELASTICSEARCH_URL=http://<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">9200</span> -p <span class="number">5601</span>:<span class="number">5601</span> -d kibana</span><br></pre></td></tr></table></figure>
<ul>
<li><h5 id="安装fluentd"><a href="#安装fluentd" class="headerlink" title="安装fluentd"></a>安装fluentd</h5></li>
</ul>
<h6 id="1、自定义fluentd的Dockerfile"><a href="#1、自定义fluentd的Dockerfile" class="headerlink" title="1、自定义fluentd的Dockerfile"></a>1、自定义fluentd的Dockerfile</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">FROM fluent/fluentd:v1.2</span><br><span class="line"></span><br><span class="line"># below RUN includes plugin as examples elasticsearch is not required</span><br><span class="line"># you may customize including plugins as you wish</span><br><span class="line"></span><br><span class="line">RUN apk add --update --virtual .build-deps \</span><br><span class="line">                                sudo \</span><br><span class="line">                                build-base \</span><br><span class="line">                                ruby-dev \</span><br><span class="line">                                tzdata \</span><br><span class="line">    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \</span><br><span class="line">    &amp;&amp; sudo gem install fluent-plugin-elasticsearch \</span><br><span class="line">    &amp;&amp; sudo gem install fluent-plugin-kafka \</span><br><span class="line">    &amp;&amp; sudo gem sources --clear-all \</span><br><span class="line">    &amp;&amp; apk del .build-deps \</span><br><span class="line">    &amp;&amp; rm -rf /var/cache/apk/* \</span><br><span class="line">              /home/fluent/.gem/ruby/2.3.0/cache/*.gem</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;fluentd&quot;, &quot;-c&quot;, &quot;/fluentd/etc/fluent.conf&quot;, &quot;-p&quot;, &quot;/fluentd/plugins&quot;]</span><br></pre></td></tr></table></figure>
<h6 id="2、编写fluent-conf"><a href="#2、编写fluent-conf" class="headerlink" title="2、编写fluent.conf"></a>2、编写fluent.conf</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;system&gt;</span><br><span class="line">  rpc_endpoint 127.0.0.1:24444</span><br><span class="line">&lt;/system&gt;</span><br><span class="line">&lt;source&gt;</span><br><span class="line">	@type forward</span><br><span class="line">	@id forward_input</span><br><span class="line">&lt;/source&gt;</span><br><span class="line"></span><br><span class="line">&lt;source&gt;</span><br><span class="line">		@type    tail  #### tail方式采集日志</span><br><span class="line">		#format   none</span><br><span class="line">		format   /^(?&lt;all&gt;.*)$/</span><br><span class="line">		path     /log/log.txt</span><br><span class="line">		pos_file /log/pos_file/httpd-access.log.pos</span><br><span class="line">		tag      log.tag</span><br><span class="line">&lt;/source&gt;</span><br><span class="line"></span><br><span class="line">&lt;match log.**&gt;</span><br><span class="line">       @type copy</span><br><span class="line">       &lt;store&gt;</span><br><span class="line">        @type elasticsearch</span><br><span class="line">        hosts localhost:9200</span><br><span class="line">        type_name elasticsearch_fluentd</span><br><span class="line">        include_tag_key true</span><br><span class="line">        tag_key log_name</span><br><span class="line">        flush_interval 10s # for testing</span><br><span class="line">        logstash_format true</span><br><span class="line">        logstash_prefix logstash</span><br><span class="line">       &lt;/store&gt;</span><br><span class="line">       &lt;store&gt;</span><br><span class="line">         @type     kafka</span><br><span class="line">		brokers              localhost:9092</span><br><span class="line">		#zookeeper           localhost:2181</span><br><span class="line">		default_topic       fluent_kafka</span><br><span class="line">		#刷新间隔</span><br><span class="line">		flush_interval      30</span><br><span class="line">		ack_timeout      2000</span><br><span class="line">		output_data_type    attr:all</span><br><span class="line">       &lt;/store&gt;</span><br><span class="line"></span><br><span class="line">&lt;/match&gt;</span><br><span class="line"></span><br><span class="line">&lt;source&gt;</span><br><span class="line">	@type monitor_agent</span><br><span class="line">	@id monitor_agent_input</span><br><span class="line">	port 24220</span><br><span class="line">&lt;/source&gt;</span><br><span class="line"></span><br><span class="line">&lt;match debug.**&gt;</span><br><span class="line">	@type stdout</span><br><span class="line">&lt;/match&gt;</span><br></pre></td></tr></table></figure>
<h6 id="3、构建fluentd-image"><a href="#3、构建fluentd-image" class="headerlink" title="3、构建fluentd image:"></a>3、构建fluentd image:</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t fluentd:test -f Dockerfile .</span><br></pre></td></tr></table></figure>
<h6 id="4、启动fluentd"><a href="#4、启动fluentd" class="headerlink" title="4、启动fluentd"></a>4、启动fluentd</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm --name fluent_test -v $(pwd)/log/:/log/ -v $(pwd)/:/fluentd/etc/ fluentd:test</span><br></pre></td></tr></table></figure>
<p>==说明==</p>
<p>配置fluentd的RPC 为了重新加载fluentd.conf文件<br>参考：<a href="https://docs.fluentd.org/v1.0/articles/rpc" target="_blank" rel="noopener">https://docs.fluentd.org/v1.0/articles/rpc</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;system&gt;</span><br><span class="line">  rpc_endpoint 127.0.0.1:24444</span><br><span class="line">&lt;/system&gt;</span><br></pre></td></tr></table></figure>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">增加这个文件的日志    echo  test &gt; $(pwd)/log/log.txt</span><br></pre></td></tr></table></figure>
<p>在kibana中进行日志查看：</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/FB957D2F60304CDC9043EFF343CB6B61?method=download&amp;shareKey=a31b0bd854f7e7fad8dd9f952117006f" alt="image"></p>
<p>修改fluent.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tag_key log_name 修改为tag_key log_name_key</span><br><span class="line">执行curl http://127.0.0.1:24444/api/config.reload</span><br></pre></td></tr></table></figure>
<p>即可以重新加载fluent.conf配置文件，使其生效<br>继续向log.txt写入日志</p>
<p>fluentd向kafka写入日志</p>
<p>进入kafka的container中</p>
<p>执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic fluent_kafka --from-beginning</span><br></pre></td></tr></table></figure>
<p>附上kafka基本命令 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">创建topic 这里创建的topic为：</span><br><span class="line">bin/kafka-topics.sh --create --zookeeper zookeeper:2181 --replication-factor 1 --partitions 1 --topic </span><br><span class="line"></span><br><span class="line">查看topic</span><br><span class="line">king bin/kafka-topics.sh --list --zookeeper zookeeper:2181</span><br><span class="line"></span><br><span class="line">挂起生产者：producer</span><br><span class="line">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test</span><br><span class="line"></span><br><span class="line">挂起之后，就可以输入信息：test</span><br><span class="line">挂起消费者： consumer:</span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning</span><br><span class="line"></span><br><span class="line">在consulmer就可以看到生产出来的：test</span><br></pre></td></tr></table></figure>
<p>至此完成了基本的elk  和fluent+kafka+zookeeper的日志系统</p>
<p>在kubernets中使用DaemonSet  来获取主机日志或docker container日志</p>
<p>参考：<a href="https://docs.fluentd.org/v1.0/articles/quickstart" target="_blank" rel="noopener">https://docs.fluentd.org/v1.0/articles/quickstart</a></p>
<p>​           <a href="https://www.elastic.co/products" target="_blank" rel="noopener">https://www.elastic.co/products</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/26/dragonfly/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pengemailcom@163.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Peng">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/26/dragonfly/" itemprop="url">dragonfly 之 p2p 镜像分发</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-26T09:07:21+08:00">
                2019-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>支持https harbor，公有或私有仓库<br>支持push image </p>
<h3 id="什么是dragonfly"><a href="#什么是dragonfly" class="headerlink" title="什么是dragonfly"></a>什么是dragonfly</h3><p> Dragonfly 是一款基于 P2P 的智能镜像和文件分发工具。它旨在提高文件传输的效率和速率，最大限度地利用网络带宽，尤其是在分发大量数据时，例如应用分发、缓存分发、日志分发和镜像分发。</p>
<p>在阿里巴巴，Dragonfly 每个月会被调用 20 亿次，分发的数据量高达 3.4PB。Dragonfly 已成为阿里巴巴基础设施中的重要一环。</p>
<p>尽管容器技术大部分时候简化了运维工作，但是它也带来了一些挑战：例如镜像分发的效率问题，尤其是必须在多个主机上复制镜像分发时。</p>
<p>Dragonfly 在这种场景下能够完美支持 Docker 和 PouchContainer。它也兼容其他格式的容器。相比原生方式，它能将容器分发速度提高 57 倍，并让 Registry 网络出口流量降低 99.5%。</p>
<p>Dragonfly 能让所有类型的文件、镜像或数据分发变得简单而经济。</p>
<h3 id="Dragonfly-有何优势（具备以下特性）？"><a href="#Dragonfly-有何优势（具备以下特性）？" class="headerlink" title="Dragonfly 有何优势（具备以下特性）？"></a>Dragonfly 有何优势（具备以下特性）？</h3><ul>
<li>基于 P2P 的文件分发：通过利用 P2P 技术进行文件传输，它能最大限度地利用每个对等节点（Peer）的带宽资源，以提高下载效率，并节省大量跨机房带宽，尤其是昂贵的跨境带宽。</li>
<li>非侵入式支持所有类型的容器技术：Dragonfly 可无缝支持多种容器用于分发镜像。</li>
<li>机器级别的限速：除了像许多其他下载工具（例如 wget 和 curl）那样的针对当前下载任务的限速之外，Dragonfly 还支持针对整个机器的限速。</li>
<li>被动式 CDN：这种 CDN 机制可防止重复远程下载。</li>
<li>高度一致性：Dragonfly 可确保所有下载的文件是一致的，即使用户不提供任何检查代码（MD5）。</li>
<li>磁盘保护和高效 IO：预检磁盘空间、延迟同步、以最佳顺序写文件分块、隔离网络-读/磁盘-写等等。</li>
<li>高性能：SuperNode 是完全闭环的，意味着它不依赖任何数据库或分布式缓存，能够以极高性能处理请求。</li>
<li>自动隔离异常：Dragonfly 会自动隔离异常节点（对等节点或 SuperNode）来提高下载稳定性。</li>
<li>对文件源无压力：一般只有少数几个 SuperNode 会从源下载文件。</li>
<li>支持标准 HTTP 头文件：支持通过 HTTP 头文件提交鉴权信息。</li>
<li>有效的 Registry 鉴权并发控制：减少对 Registry 鉴权服务的压力。</li>
<li>简单易用：仅需极少的配置。</li>
</ul>
<h3 id="dragonfly原理"><a href="#dragonfly原理" class="headerlink" title="dragonfly原理"></a>dragonfly原理</h3><p>Dragonfly 下载普通文件和下载容器镜像的工作原理略有不同。</p>
<h5 id="下载普通文件"><a href="#下载普通文件" class="headerlink" title="下载普通文件"></a>下载普通文件</h5><p>SuperNode 充当 CDN，并负责调度对等节点（Peer）之间的文件分块传输。dfget 是 P2P 客户端，也称为“Peer”（对等节点），主要用于下载和共享文件分块。</p>
<p><img src="https://d7y.io/docs/zh-cn/img/dfget.png" alt="image"></p>
<h4 id="下载镜像文件"><a href="#下载镜像文件" class="headerlink" title="下载镜像文件"></a>下载镜像文件</h4><p>Registry 类似于文件服务器。dfget proxy 也称为 dfdaemon，会拦截来自 docker pull 或 docker push 的 HTTP 请求，然后使用 dfget 来处理那些跟镜像分层相关的请求。</p>
<p><img src="https://d7y.io/docs/zh-cn/img/dfget-combine-container.png" alt="image"></p>
<h4 id="下载文件分块"><a href="#下载文件分块" class="headerlink" title="下载文件分块"></a>下载文件分块</h4><p>每个文件会被分成多个分块，并在对等节点之间传输。一个对等节点就是一个 P2P 客户端。SuperNode 会判断本地是否存在对应的文件。如果不存在，则会将其从文件服务器下载到 SuperNode。</p>
<p><img src="https://d7y.io/docs/zh-cn/img/distributing.png" alt="image"></p>
<h3 id="dragonfly部署（参考dragonfly官网）"><a href="#dragonfly部署（参考dragonfly官网）" class="headerlink" title="dragonfly部署（参考dragonfly官网）"></a>dragonfly部署（参考dragonfly官网）</h3><p><a href="https://d7y.io/zh-cn/" target="_blank" rel="noopener">https://d7y.io/zh-cn/</a></p>
<h3 id="dragonfly-https的harbor"><a href="#dragonfly-https的harbor" class="headerlink" title="dragonfly https的harbor"></a>dragonfly https的harbor</h3><p>dragonfly 常见问题</p>
<p><a href="https://github.com/dragonflyoss/Dragonfly/blob/master/FAQ.md" target="_blank" rel="noopener">https://github.com/dragonflyoss/Dragonfly/blob/master/FAQ.md</a></p>
<p>目的：启用 docker PROXY  让dragonfly 支持https </p>
<h4 id="1、部署https-harbor"><a href="#1、部署https-harbor" class="headerlink" title="1、部署https harbor"></a>1、部署https harbor</h4><p><a href="https://github.com/goharbor/harbor/blob/master/docs/configure_https.md" target="_blank" rel="noopener">https://github.com/goharbor/harbor/blob/master/docs/configure_https.md</a></p>
<h4 id="2、部署docker-proxy"><a href="#2、部署docker-proxy" class="headerlink" title="2、部署docker_proxy"></a>2、部署docker_proxy</h4><p>pull images</p>
<p>pull_images.sh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">docker_registry_proxy=&quot;dockerhubwp/docker_proxy_nginx:latest&quot;</span><br><span class="line">supernode=&quot;registry.cn-hangzhou.aliyuncs.com/alidragonfly/supernode:0.2.0&quot;</span><br><span class="line">dfclient=&quot;dockerhubwp/dfclient:latest&quot;</span><br><span class="line"></span><br><span class="line">images=&quot;$&#123;docker_registry_proxy&#125; $&#123;supernode&#125; $&#123;dfclient&#125;&quot;</span><br><span class="line"></span><br><span class="line">function pullImage()&#123;</span><br><span class="line">   for image in $&#123;images&#125;; do</span><br><span class="line">        echo -e &quot;pull image ======&gt;$&#123;image&#125;&quot;</span><br><span class="line">        docker pull $&#123;image&#125;</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pullImage</span><br></pre></td></tr></table></figure></p>
<p>docker_proxy.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/sh</span><br><span class="line"></span><br><span class="line">#   Separate deployment docker_proxy</span><br><span class="line"></span><br><span class="line"># dfdaemon and docker registry map</span><br><span class="line"># example  x.x.x</span><br><span class="line">registry=&quot;harbor域名&quot;</span><br><span class="line">containername=docker_registry_proxy</span><br><span class="line">#  你需要配置的dns 服务器 (如：dnsmasq)  </span><br><span class="line">DNS_SERVER=&quot;dns-server&quot;</span><br><span class="line">docker_registry_proxy=&quot;dockerhubwp/docker_proxy_nginx:latest&quot;</span><br><span class="line"></span><br><span class="line"># get localhost ip</span><br><span class="line">ipaddr=$(ip addr | awk &apos;/^[0-9]+: / &#123;&#125;; /inet.*global/ &#123;print gensub(/(.*)\/(.*)/, &quot;\\1&quot;, &quot;g&quot;, $2)&#125;&apos;)</span><br><span class="line">localhostIp=$(echo $&#123;ipaddr&#125; | cut -d &quot; &quot; -f 1)</span><br><span class="line"></span><br><span class="line">function changeDockerProxy() &#123;</span><br><span class="line">    mkdir -p /etc/systemd/system/docker.service.d</span><br><span class="line">	cat &lt;&lt;EOD &gt;/etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="line">[Service]</span><br><span class="line">Environment=&quot;HTTP_PROXY=http://127.0.0.1:3128/&quot;</span><br><span class="line">Environment=&quot;HTTPS_PROXY=http://127.0.0.1:3128/&quot;</span><br><span class="line">EOD</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function dockerDockerProxyRun() &#123;</span><br><span class="line">    if [[ 0 != $(docker ps -a | grep $&#123;containername&#125; | wc -l) ]]; then</span><br><span class="line">        docker rm -f $&#123;containername&#125;</span><br><span class="line">    fi</span><br><span class="line">    docker run --restart=always --privileged=true --name $&#123;containername&#125; -d -p 0.0.0.0:3128:3128 -v /etc/docker_proxy_nginx/docker_mirror_certs:/ca -v /var/log/docker_proxy_nginx:/var/log/nginx/ -e DRAGONFLY_REGISTRIES=&quot;$&#123;registry&#125;,http://$&#123;localhostIp&#125;:65001&quot; -e REGISTRIES=&quot;$&#123;registry&#125;&quot; -e DNS_SERVER=$&#123;DNS_SERVER&#125; $&#123;docker_registry_proxy&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">changeDockerProxy</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line">dockerDockerProxyRun</span><br></pre></td></tr></table></figure>
<h4 id="3、部署dragonfly"><a href="#3、部署dragonfly" class="headerlink" title="3、部署dragonfly"></a>3、部署dragonfly</h4><h5 id="部署Supernode"><a href="#部署Supernode" class="headerlink" title="部署Supernode"></a>部署Supernode</h5><p>supernode.sh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">#   Separate deployment supernode</span><br><span class="line"></span><br><span class="line">supernode=&quot;registry.cn-hangzhou.aliyuncs.com/alidragonfly/supernode:0.2.0&quot;</span><br><span class="line">containername=supernode</span><br><span class="line"></span><br><span class="line">function superNode() &#123;</span><br><span class="line">    if [[ 0 != $(docker ps -a | grep $&#123;containername&#125; | wc -l) ]]; then</span><br><span class="line">        docker rm -f $&#123;containername&#125;</span><br><span class="line">    fi</span><br><span class="line">    docker run --name $&#123;containername&#125; --restart=always -d -p 8001:8001 -p 8002:8002 $&#123;supernode&#125;</span><br><span class="line">&#125;</span><br><span class="line">superNode</span><br></pre></td></tr></table></figure></p>
<h5 id="部署dfclient"><a href="#部署dfclient" class="headerlink" title="部署dfclient"></a>部署dfclient</h5><p>dfclient.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">#   Separate deployment docker_proxy</span><br><span class="line"></span><br><span class="line">dfclient=&quot;dockerhubwp/dfclient:latest&quot;</span><br><span class="line"></span><br><span class="line">#harbor 地址</span><br><span class="line">dfdaemon_registry=&quot;https://x.x.x&quot;</span><br><span class="line">containername=dfclient</span><br><span class="line"></span><br><span class="line"># supernode ips  example (10.0.0.160,10.0.0.162)</span><br><span class="line">supernodes=&quot;supernodeip&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ipaddr=$(ip addr | awk &apos;/^[0-9]+: / &#123;&#125;; /inet.*global/ &#123;print gensub(/(.*)\/(.*)/, &quot;\\1&quot;, &quot;g&quot;, $2)&#125;&apos;)</span><br><span class="line">localhostIp=$(echo $&#123;ipaddr&#125; | cut -d &quot; &quot; -f 1)</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOD &gt;/etc/dragonfly.conf</span><br><span class="line">[node]</span><br><span class="line">address=$&#123;supernodes&#125;</span><br><span class="line">EOD</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function startDfClient() &#123;</span><br><span class="line">    if [[ 0 != $(docker ps -a | grep $&#123;containername&#125; | wc -l) ]]; then</span><br><span class="line">        docker rm -f $&#123;containername&#125;</span><br><span class="line">    fi</span><br><span class="line">    docker run --name $&#123;containername&#125; --restart=always -d  -p 65001:65001 -v /root/.small-dragonfly:/root/.small-dragonfly -v /etc/dragonfly.conf:/etc/dragonfly.conf  -e dfdaemon_registry=$&#123;dfdaemon_registry&#125; -e localhostIp=$&#123;localhostIp&#125; $&#123;dfclient&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">startDfClient</span><br></pre></td></tr></table></figure>
<p>最后</p>
<p>trust.sh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line"># trust ca</span><br><span class="line"></span><br><span class="line">curl http://127.0.0.1:3128/ca.crt &gt;/etc/pki/ca-trust/source/anchors/docker_proxy_nginx.crt</span><br><span class="line"></span><br><span class="line">update-ca-trust</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull x.x.x/library/nginx:latest</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p>   <a href="https://d7y.io/zh-cn/" target="_blank" rel="noopener">https://d7y.io/zh-cn/</a></p>
<p>   <a href="https://github.com/goharbor/harbor/" target="_blank" rel="noopener">https://github.com/goharbor/harbor/</a></p>
<p>   <a href="https://github.com/rpardini/docker-registry-proxy" target="_blank" rel="noopener">https://github.com/rpardini/docker-registry-proxy</a></p>
<p>   <a href="https://github.com/chobits/ngx_http_proxy_connect_module" target="_blank" rel="noopener">https://github.com/chobits/ngx_http_proxy_connect_module</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/25/nginx-https/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pengemailcom@163.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Peng">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/25/nginx-https/" itemprop="url">搭建nginx-https</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-25T12:24:07+08:00">
                2019-02-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="nginx-https"><a href="#nginx-https" class="headerlink" title="nginx https"></a>nginx https</h2><p>defalut.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   upstream www.aaa.com.38240.r1.up &#123;</span><br><span class="line"></span><br><span class="line">       server 127.0.0.1:8443  weight=1  max_fails=1 fail_timeout=10s;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line">       listen                        38240;</span><br><span class="line">       server_name                   registry.wise2c.com;</span><br><span class="line"></span><br><span class="line">       access_log                    /var/log/nginx/host.access.log  main;</span><br><span class="line">       error_log                     /var/log/nginx/host_error.log;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       # for support ssl</span><br><span class="line"></span><br><span class="line">       ssl                           on;</span><br><span class="line">       ssl_certificate               /etc/nginx/registry.wise2c.com.crt;</span><br><span class="line">       ssl_certificate_key           /etc/nginx/registry.wise2c.com.key;</span><br><span class="line">       ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">       ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">       ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      proxy_headers_hash_max_size     51200;</span><br><span class="line">      proxy_headers_hash_bucket_size  6400;</span><br><span class="line">      proxy_set_header                X-Forwarded-For  $remote_addr;</span><br><span class="line">      proxy_set_header                Host             $http_host;</span><br><span class="line">      proxy_set_header                X-Real-IP        $remote_addr;</span><br><span class="line">      proxy_set_header                X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">      add_header Upgrade &quot;TLS/1.2, HTTP/1.1&quot;;</span><br><span class="line">      add_header Connection &quot;Upgrade&quot;;</span><br><span class="line">      add_header PPP  https://$host:$server_port$uri/;</span><br><span class="line">      error_page   500 502 503 504  /50x.html;</span><br><span class="line">       location = /50x.html &#123;</span><br><span class="line">           root   html;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       location / &#123;</span><br><span class="line">               proxy_pass                http://www.aaa.com.38240.r1.up/;</span><br><span class="line">               proxy_connect_timeout     2s;</span><br><span class="line">               proxy_redirect http:// $scheme://;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">https http</span><br><span class="line"></span><br><span class="line">端口(88)相同  域名不相同  </span><br><span class="line"></span><br><span class="line">访问http://www.xx.com:88     400  </span><br><span class="line">访问https://www.xxx.com:88     200</span><br><span class="line"></span><br><span class="line">端口相同  域名相同  只有https的存在</span><br><span class="line"></span><br><span class="line">问题</span><br><span class="line">nginx log</span><br><span class="line"></span><br><span class="line">2019/02/25 08:10:46 [warn] 1#1: conflicting server name &quot;registry.wise2c.com&quot; on 0.0.0.0:38240, ignored</span><br><span class="line">nginx: [warn] conflicting server name &quot;registry.wise2c.com&quot; on 0.0.0.0:38240, ignored</span><br><span class="line"></span><br><span class="line">端口不相同  域名相同 200</span><br></pre></td></tr></table></figure>
<h2 id="Nginx环境下http和https可同时访问方法"><a href="#Nginx环境下http和https可同时访问方法" class="headerlink" title="Nginx环境下http和https可同时访问方法"></a>Nginx环境下http和https可同时访问方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 80 default backlog=2048;</span><br><span class="line">listen 443 ssl;</span><br><span class="line">server_name x.x.x;</span><br><span class="line">root /var/www/html;</span><br><span class="line">ssl_certificate /usr/local/Tengine/sslcrt/domain.crt;</span><br><span class="line">ssl_certificate_key /usr/local/Tengine/sslcrt/domain.Key;</span><br><span class="line"></span><br><span class="line"> location / &#123;</span><br><span class="line">                proxy_pass                http://www.aaa.com.38240.r1.up/;</span><br><span class="line">                proxy_connect_timeout     2s;</span><br><span class="line">                proxy_redirect http:// $scheme://;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">https://www.ixsystems.com/community/threads/how-to-owncloud-using-nginx-php-fpm-and-mysql.17786/page-78#post-395092</span><br><span class="line">过添加</span><br><span class="line"></span><br><span class="line">client_body_in_file_only clean 找到解决方案; </span><br><span class="line">client_body_buffer_size 32K; #set </span><br><span class="line"></span><br><span class="line">max upload size </span><br><span class="line">client_max_body_size 4000M; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       add_header X-Xss-Protection“1; mode = block”总是;</span><br><span class="line">	   add_header X-Content-Type-Options“nosniff”总是;</span><br><span class="line">	   add_header Strict-Transport-Security“max-age = 2592000; includeSubdomains”总是;</span><br><span class="line">	   add_header X-Frame-Options“SAMEORIGIN”总是;</span><br><span class="line">	   proxy_hide_header X-Powered-By;</span><br><span class="line">	   add_header&apos;Referrer-Policy&apos;&apos;no-referrer&apos;;</span><br><span class="line">	   add_header Content-Security-Policy“frame-ancestors mydomain.eu;”;</span><br></pre></td></tr></table></figure>
<p>dragonfly docker proxy   branch fix-md2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line">    server_name localhost;</span><br><span class="line"></span><br><span class="line">    # 上面生成的自签名证书</span><br><span class="line">    ssl_certificate /tmp/ssl/server.crt;</span><br><span class="line">    ssl_certificate_key /tmp/ssl/server.key;</span><br><span class="line"></span><br><span class="line">    ssl_session_timeout 5m;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_set_header  X-Real-IP  $remote_addr;</span><br><span class="line">        proxy_set_header  Host $host;</span><br><span class="line">        proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        # 后端服务</span><br><span class="line">        proxy_pass http://localhost:8080;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/25/kafka/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pengemailcom@163.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Peng">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/25/kafka/" itemprop="url">docker 版kafka集群搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-25T10:27:45+08:00">
                2019-02-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="kafka-集群搭建"><a href="#kafka-集群搭建" class="headerlink" title="kafka 集群搭建"></a>kafka 集群搭建</h2><p>参考:<a href="https://hub.docker.com/r/wurstmeister/kafka/tags" target="_blank" rel="noopener">https://hub.docker.com/r/wurstmeister/kafka/tags</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  zookeeper:</span><br><span class="line">    image: wurstmeister/zookeeper</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;2181:2181&quot;</span><br><span class="line">  kafka:</span><br><span class="line">    image: wurstmeister/kafka</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9092&quot;</span><br><span class="line">    environment:</span><br><span class="line">      KAFKA_ADVERTISED_HOST_NAME: 10.0.0.159  #需要改成宿主ip</span><br><span class="line">      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181</span><br><span class="line">    volumes:</span><br><span class="line">      - /var/run/docker.sock:/var/run/docker.sock</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br><span class="line">docker-compose scale kafka=3</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/24/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pengemailcom@163.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Peng">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/24/hello-world/" itemprop="url">Use Hexo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-24T17:50:38+08:00">
                2019-02-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">pengemailcom@163.com</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">pengemailcom@163.com</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
