<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">

  <!-- PACE Progress Bar START -->
  
    <script src="https://raw.githubusercontent.com/HubSpot/pace/v1.0.2/pace.min.js"></script>
    <link rel="stylesheet" href="https://github.com/HubSpot/pace/raw/master/themes/orange/pace-theme-flash.css">
  
  

  <!-- PACE Progress Bar START -->

  
  <title>Peng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="Peng">
<meta property="og:url" content="https://upengs.github.io/page/2/index.html">
<meta property="og:site_name" content="Peng">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Peng">
  
    <link rel="alternate" href="/atom.xml" title="Peng" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="https://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/hiero.css">
  <link rel="stylesheet" href="/css/glyphs.css">
  

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/my.css">
  <!-- Google Adsense -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
      (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-0123456789ABCDEFl",
          enable_page_level_ads: true
      });
  </script>
  
</head>
</html>
<script>
var themeMenus = {};

  themeMenus["/"] = "Home"; 

  themeMenus["/archives"] = "Archives"; 

  themeMenus["/categories"] = "Categories"; 

  themeMenus["/tags"] = "Tags"; 

  themeMenus["/about"] = "About"; 

</script>


  <body>


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="Peng" rel="home"> Peng </a>
            
          </h1>

          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/categories">Categories</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">Tags</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>


  <div id="originBgDiv" style="background: #fff; width: 100%;">

      <div style="max-height:600px; overflow: hidden;  display: flex; display: -webkit-flex; align-items: center;">
        <img id="originBg" width="100%" alt="" src="">
      </div>

  </div>

  <script>
  function setAboutIMG(){
      var imgUrls = "css/images/pose.jpg,https://source.unsplash.com/collection/954550/1920x1080".split(",");
      var random = Math.floor((Math.random() * imgUrls.length ));
      if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
        document.getElementById("originBg").src=imgUrls[random];
      } else {
        document.getElementById("originBg").src='/' + imgUrls[random];
      }
  }
  bgDiv=document.getElementById("originBgDiv");
  if(location.pathname.match('about')){
    setAboutIMG();
    bgDiv.style.display='block';
  }else{
    bgDiv.style.display='none';
  }
  </script>



  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main">
  
    <article id="post-kubectl-config"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2019/08/07/kubectl-config/">通过配置kubectl config对多个kubernetes群集的访问</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2019/08/07/kubectl-config/" class="article-date">
	  <time datetime="2019-08-07T01:34:21.000Z" itemprop="datePublished">August 7, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>目的：在使用kubernetes集群的时候当用户访问不同的kubernetes环境的时候可以随意切换<br>     通过设置ClusterRole  Role中的rules来控制集群下资源的操作</p>
<h3 id="以下主要介绍用不同的kubernetes的认证信息来访问集群中的指定的namespace"><a href="#以下主要介绍用不同的kubernetes的认证信息来访问集群中的指定的namespace" class="headerlink" title="以下主要介绍用不同的kubernetes的认证信息来访问集群中的指定的namespace"></a>以下主要介绍用不同的kubernetes的认证信息来访问集群中的指定的namespace</h3><h4 id="1、通过Token访问"><a href="#1、通过Token访问" class="headerlink" title="1、通过Token访问"></a>1、通过Token访问</h4><h4 id="2、通过用户名密码访问"><a href="#2、通过用户名密码访问" class="headerlink" title="2、通过用户名密码访问"></a>2、通过用户名密码访问</h4><h4 id="3、通过RBAC-来访问"><a href="#3、通过RBAC-来访问" class="headerlink" title="3、通过RBAC 来访问"></a>3、通过RBAC 来访问</h4><h3 id="先了解一番-kubectl-config-命令："><a href="#先了解一番-kubectl-config-命令：" class="headerlink" title="先了解一番 kubectl config 命令："></a>先了解一番 kubectl config 命令：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Modify kubeconfig files using subcommands like <span class="string">"kubectl config set current-context my-context"</span></span><br><span class="line"></span><br><span class="line"> The loading order follows these rules:</span><br><span class="line"></span><br><span class="line">  1.  If the --kubeconfig flag is <span class="built_in">set</span>, <span class="keyword">then</span> only that file is loaded. The flag may only be <span class="built_in">set</span> once and no merging takes</span><br><span class="line">place.</span><br><span class="line">  2.  If <span class="variable">$KUBECONFIG</span> environment variable is <span class="built_in">set</span>, <span class="keyword">then</span> it is used as a list of paths (normal path delimiting rules <span class="keyword">for</span></span><br><span class="line">your system). These paths are merged. When a value is modified, it is modified <span class="keyword">in</span> the file that defines the stanza. When</span><br><span class="line">a value is created, it is created <span class="keyword">in</span> the first file that exists. If no files <span class="keyword">in</span> the chain exist, <span class="keyword">then</span> it creates the</span><br><span class="line">last file <span class="keyword">in</span> the list.</span><br><span class="line">  3.  Otherwise, <span class="variable">$&#123;HOME&#125;</span>/.kube/config is used and no merging takes place.</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  current-context Displays the current-context</span><br><span class="line">  delete-cluster  Delete the specified cluster from the kubeconfig</span><br><span class="line">  delete-context  Delete the specified context from the kubeconfig</span><br><span class="line">  get-clusters    Display clusters defined <span class="keyword">in</span> the kubeconfig</span><br><span class="line">  get-contexts    Describe one or many contexts</span><br><span class="line">  rename-context  Renames a context from the kubeconfig file.</span><br><span class="line">  <span class="built_in">set</span>             Sets an individual value <span class="keyword">in</span> a kubeconfig file</span><br><span class="line">  <span class="built_in">set</span>-cluster     Sets a cluster entry <span class="keyword">in</span> kubeconfig</span><br><span class="line">  <span class="built_in">set</span>-context     Sets a context entry <span class="keyword">in</span> kubeconfig</span><br><span class="line">  <span class="built_in">set</span>-credentials Sets a user entry <span class="keyword">in</span> kubeconfig</span><br><span class="line">  <span class="built_in">unset</span>           Unsets an individual value <span class="keyword">in</span> a kubeconfig file</span><br><span class="line">  use-context     Sets the current-context <span class="keyword">in</span> a kubeconfig file</span><br><span class="line">  view            Display merged kubeconfig settings or a specified kubeconfig file</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  kubectl config SUBCOMMAND [options]</span><br><span class="line"></span><br><span class="line">Use <span class="string">"kubectl &lt;command&gt; --help"</span> <span class="keyword">for</span> more information about a given <span class="built_in">command</span>.</span><br><span class="line">Use <span class="string">"kubectl options"</span> <span class="keyword">for</span> a list of global <span class="built_in">command</span>-line options (applies to all commands).</span><br></pre></td></tr></table></figure>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h4 id="1、设置api-server的token-认证信息"><a href="#1、设置api-server的token-认证信息" class="headerlink" title="1、设置api-server的token  认证信息"></a>1、设置api-server的token  认证信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/kubernetes/pki/token_auth_file&lt;&lt;EOF</span><br><span class="line">11111111111111,username,1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h4 id="2、设置api-server的username-password认证信息"><a href="#2、设置api-server的username-password认证信息" class="headerlink" title="2、设置api-server的username password认证信息"></a>2、设置api-server的username password认证信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/kubernetes/pki/basic_auth_file&lt;&lt;EOF</span><br><span class="line">password,username,1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h4 id="3、修改api-server的启动参数"><a href="#3、修改api-server的启动参数" class="headerlink" title="3、修改api-server的启动参数"></a>3、修改api-server的启动参数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- --token-auth-file=/etc/kubernetes/pki/token_auth_file</span><br><span class="line">- --basic-auth-file=/etc/kubernetes/pki/basic_auth_file</span><br></pre></td></tr></table></figure>
<h4 id="4、-重启apisever"><a href="#4、-重启apisever" class="headerlink" title="4、 重启apisever"></a>4、 重启apisever</h4><h4 id="5、test-api-server-是否配置成功"><a href="#5、test-api-server-是否配置成功" class="headerlink" title="5、test api-server 是否配置成功"></a>5、test api-server 是否配置成功</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CLUSTER_NAME=kubernetes</span><br><span class="line">API_SERVER=$(kubectl config view -o jsonpath=<span class="string">"&#123;.clusters[?(@.name==\"<span class="variable">$&#123;CLUSTER_NAME&#125;</span>\")].cluster.server&#125;"</span>)</span><br><span class="line">curl <span class="variable">$&#123;API_SERVER&#125;</span>/version --basic -u username:password -k</span><br><span class="line">curl <span class="variable">$&#123;API_SERVER&#125;</span>/version --header <span class="string">"Authorization: Bearer 11111111111111"</span> -k</span><br></pre></td></tr></table></figure>
<h4 id="6、添加ClusterRole"><a href="#6、添加ClusterRole" class="headerlink" title="6、添加ClusterRole"></a>6、添加ClusterRole</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">wp-cluster-role</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">- apiGroups:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">'*'</span></span><br><span class="line"><span class="attr">  resources:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">'*'</span></span><br><span class="line"><span class="attr">  verbs:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">'*'</span></span><br><span class="line"><span class="attr">- nonResourceURLs:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">'*'</span></span><br><span class="line"><span class="attr">  verbs:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">'*'</span></span><br></pre></td></tr></table></figure>
<h4 id="7、创建一个用于测试的namespace-wp"><a href="#7、创建一个用于测试的namespace-wp" class="headerlink" title="7、创建一个用于测试的namespace wp"></a>7、创建一个用于测试的namespace wp</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create ns wp</span><br></pre></td></tr></table></figure>
<h4 id="8、创建RoleBinding"><a href="#8、创建RoleBinding" class="headerlink" title="8、创建RoleBinding"></a>8、创建RoleBinding</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">wp-role-binding</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">wp</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">  kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">wp-cluster-role</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">wp</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">User</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">username</span></span><br></pre></td></tr></table></figure>
<h2 id="下面进行实际操作"><a href="#下面进行实际操作" class="headerlink" title="下面进行实际操作"></a>下面进行实际操作</h2><h3 id="一、使用api-server-token来访问kubernetes"><a href="#一、使用api-server-token来访问kubernetes" class="headerlink" title="一、使用api-server token来访问kubernetes"></a>一、使用api-server token来访问kubernetes</h3><h4 id="1、通过命令获取kubernetes-cluster-server"><a href="#1、通过命令获取kubernetes-cluster-server" class="headerlink" title="1、通过命令获取kubernetes cluster server"></a>1、通过命令获取kubernetes cluster server</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CLUSTER_NAME=kubernetes</span><br><span class="line">API_SERVER=$(kubectl config view -o jsonpath=<span class="string">"&#123;.clusters[?(@.name==\"<span class="variable">$&#123;CLUSTER_NAME&#125;</span>\")].cluster.server&#125;"</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2、设置-config中的集群信息"><a href="#2、设置-config中的集群信息" class="headerlink" title="2、设置 config中的集群信息"></a>2、设置 config中的集群信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-cluster wp --insecure-skip-tls-verify=<span class="literal">true</span> --server=<span class="variable">$&#123;API_SERVER&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="3、通过token设置客户端认证参数"><a href="#3、通过token设置客户端认证参数" class="headerlink" title="3、通过token设置客户端认证参数"></a>3、通过token设置客户端认证参数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-credentials wp --token=11111111111111</span><br></pre></td></tr></table></figure>
<h4 id="4、设置上下文参数"><a href="#4、设置上下文参数" class="headerlink" title="4、设置上下文参数"></a>4、设置上下文参数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-context wp --cluster=wp --user=wp</span><br></pre></td></tr></table></figure>
<h4 id="5、使用当前的上下文"><a href="#5、使用当前的上下文" class="headerlink" title="5、使用当前的上下文"></a>5、使用当前的上下文</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context wp</span><br></pre></td></tr></table></figure>
<h3 id="二、-通过用户名密码来访问kubernetes"><a href="#二、-通过用户名密码来访问kubernetes" class="headerlink" title="二、 通过用户名密码来访问kubernetes"></a>二、 通过用户名密码来访问kubernetes</h3><h4 id="1、通过命令获取kubernetes-cluster-server-1"><a href="#1、通过命令获取kubernetes-cluster-server-1" class="headerlink" title="1、通过命令获取kubernetes cluster server"></a>1、通过命令获取kubernetes cluster server</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CLUSTER_NAME=kubernetes</span><br><span class="line">API_SERVER=$(kubectl config view -o jsonpath=<span class="string">"&#123;.clusters[?(@.name==\"<span class="variable">$&#123;CLUSTER_NAME&#125;</span>\")].cluster.server&#125;"</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2、设置-config中的集群信息-1"><a href="#2、设置-config中的集群信息-1" class="headerlink" title="2、设置 config中的集群信息"></a>2、设置 config中的集群信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-cluster user-pwd-cluster --insecure-skip-tls-verify=<span class="literal">true</span> --server=<span class="variable">$&#123;API_SERVER&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="3、通过token设置客户端认证参数-1"><a href="#3、通过token设置客户端认证参数-1" class="headerlink" title="3、通过token设置客户端认证参数"></a>3、通过token设置客户端认证参数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-credentials user --username=username --password=password</span><br></pre></td></tr></table></figure>
<h4 id="4、设置上下文参数-1"><a href="#4、设置上下文参数-1" class="headerlink" title="4、设置上下文参数"></a>4、设置上下文参数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-context user --cluster=user-pwd-cluster  --user=user</span><br></pre></td></tr></table></figure>
<h4 id="5、使用当前的上下文-1"><a href="#5、使用当前的上下文-1" class="headerlink" title="5、使用当前的上下文"></a>5、使用当前的上下文</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context user</span><br></pre></td></tr></table></figure>
<h3 id="三、-通过rbac-的方式-来访问kubernetes"><a href="#三、-通过rbac-的方式-来访问kubernetes" class="headerlink" title="三、 通过rbac 的方式 来访问kubernetes"></a>三、 通过rbac 的方式 来访问kubernetes</h3><h4 id="1、通过命令获取kubernetes-cluster-server-2"><a href="#1、通过命令获取kubernetes-cluster-server-2" class="headerlink" title="1、通过命令获取kubernetes cluster server"></a>1、通过命令获取kubernetes cluster server</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CLUSTER_NAME=kubernetes</span><br><span class="line">API_SERVER=$(kubectl config view -o jsonpath=<span class="string">"&#123;.clusters[?(@.name==\"<span class="variable">$&#123;CLUSTER_NAME&#125;</span>\")].cluster.server&#125;"</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2、设置-config中的集群信息-2"><a href="#2、设置-config中的集群信息-2" class="headerlink" title="2、设置 config中的集群信息"></a>2、设置 config中的集群信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-cluster sa-cluster --insecure-skip-tls-verify=<span class="literal">true</span> --server=<span class="variable">$&#123;API_SERVER&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="3、通过token设置客户端认证参数-2"><a href="#3、通过token设置客户端认证参数-2" class="headerlink" title="3、通过token设置客户端认证参数"></a>3、通过token设置客户端认证参数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-credentials sa --token=$(<span class="built_in">echo</span> $(kubectl get secrets  default-token-c82z6 -n wp -o jsonpath=<span class="string">"&#123;.data.token&#125;"</span>)|base64 -d)</span><br></pre></td></tr></table></figure>
<h4 id="4、设置上下文参数-2"><a href="#4、设置上下文参数-2" class="headerlink" title="4、设置上下文参数"></a>4、设置上下文参数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-context sa --cluster=sa-cluster --user=sa</span><br></pre></td></tr></table></figure>
<h4 id="5、使用当前的上下文-2"><a href="#5、使用当前的上下文-2" class="headerlink" title="5、使用当前的上下文"></a>5、使用当前的上下文</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context sa</span><br></pre></td></tr></table></figure>
<h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost pki]<span class="comment"># k get pod</span></span><br><span class="line">Error from server (Forbidden): pods is forbidden: User <span class="string">"system:serviceaccount:wp:default"</span> cannot list resource <span class="string">"pods"</span> <span class="keyword">in</span> API group <span class="string">""</span> <span class="keyword">in</span> the namespace <span class="string">"default"</span></span><br><span class="line">[root@localhost pki]<span class="comment"># k get pod -n wp</span></span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-7bb7cd8db5-xrwxw   1/1     Running   0          4m24s</span><br><span class="line">[root@localhost pki]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>参考：<br><a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings</a><br><a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create sa wp -n</span><br></pre></td></tr></table></figure>
<pre><code>PID=$(docker inspect --format &quot;{{ .State.Pid}}&quot; &lt;container id&gt;)

nsenter --target $PID --mount --uts --ipc --net --pid

curl -k --cacert &quot;$CERT&quot; -H  &quot;Authorization: Bearer $TOKEN_VALUE&quot; https://192.168.0.9:6443/api/v1/pods?resourceVersion=0


ln -s /Users/wupeng/go/src/gitee.com/wisecloud/ingress/controller /Users/wupeng/go/src/gitee.com/wisecloud/wisecloud-ingress-controller
</code></pre>
      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kubernetes/">kubernetes</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-Define-a-Command-and-Arguments-for-a-Container"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2019/08/03/Define-a-Command-and-Arguments-for-a-Container/">通过kubernetes将数据注入应用程序</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2019/08/03/Define-a-Command-and-Arguments-for-a-Container/" class="article-date">
	  <time datetime="2019-08-03T04:08:53.000Z" itemprop="datePublished">August 3, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="定义容器的命令和参数"><a href="#定义容器的命令和参数" class="headerlink" title="定义容器的命令和参数"></a>定义容器的命令和参数</h3><p>创建Pod时，可以为Pod中运行的容器定义命令和参数。要定义命令，请command 在配置文件中包含该字段。要定义命令的参数，请args在配置文件中包含该字段。创建Pod后，无法更改您定义的命令和参数<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">command-demo</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    purpose:</span> <span class="string">demonstrate-command</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">command-demo-container</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">debian</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">["printenv"]</span></span><br><span class="line"><span class="attr">    args:</span> <span class="string">["HOSTNAME",</span> <span class="string">"KUBERNETES_PORT"</span><span class="string">]</span></span><br><span class="line"><span class="attr">  restartPolicy:</span> <span class="string">OnFailure</span></span><br></pre></td></tr></table></figure></p>
<h3 id="使用环境变量来定义参数"><a href="#使用环境变量来定义参数" class="headerlink" title="使用环境变量来定义参数"></a>使用环境变量来定义参数</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">MESSAGE</span></span><br><span class="line"><span class="attr">  value:</span> <span class="string">"hello world"</span></span><br><span class="line"><span class="attr">command:</span> <span class="string">["/bin/echo"]</span></span><br><span class="line"><span class="attr">args:</span> <span class="string">["$(MESSAGE)"]</span></span><br></pre></td></tr></table></figure>
<h3 id="在shell中运行命令"><a href="#在shell中运行命令" class="headerlink" title="在shell中运行命令"></a>在shell中运行命令</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">command:</span> <span class="string">["/bin/sh"]</span></span><br><span class="line"><span class="attr">args:</span> <span class="string">["-c",</span> <span class="string">"while true; do echo hello; sleep 10;done"</span><span class="string">]</span></span><br></pre></td></tr></table></figure>
<p>此表总结了Docker和Kubernetes使用的字段名称。</p>
<table>
<thead>
<tr>
<th>描述</th>
<th>Docker字段名称</th>
<th>Kubernetes字段名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>该命令由容器运行</td>
<td>ENTRYPONT</td>
<td>command</td>
</tr>
<tr>
<td>传递给命令的参数</td>
<td>CMD</td>
<td>args</td>
</tr>
</tbody>
</table>
<p>当您覆盖默认的Entrypoint和Cmd时，这些规则适用：</p>
<ul>
<li>如果您不提供Container <code>command</code>或<code>args</code>使用Container，则使用Docker镜像中定义的默认值。</li>
<li>如果为Container提供<code>command</code>但不<code>args</code>提供，则仅使用提供 <code>command</code>的。默认的EntryPoint和Docker镜像中定义的默认Cmd将被忽略。</li>
<li>如果仅为<code>args</code>Container提供，则Docker镜像中定义的默认入口点将与<code>args</code>您提供的一起运行。</li>
<li>如果提供<code>command</code>和<code>args</code>，则默认的入口点和Docker镜像中定义的默认Cmd将被忽略。你<code>command</code>和你一起跑 <code>args</code>。</li>
</ul>
<p><img src="/images/image-20190803125046460.png" alt="image-20190803125046460"></p>
<h3 id="定义容器的环境变量"><a href="#定义容器的环境变量" class="headerlink" title="定义容器的环境变量"></a>定义容器的环境变量</h3><p>创建Pod时，可以为Pod中运行的容器设置环境变量。要设置环境变量，请在配置文件中包含env或 envFrom字段。</p>
<p>在本练习中，您将创建一个运行一个容器的Pod。Pod的配置文件定义了一个具有名称DEMO_GREETING和值的环境变量”Hello from the environment”。这是Pod的配置文件：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">envar-demo</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    purpose:</span> <span class="string">demonstrate-envars</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">envar-demo-container</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">gcr.io/google-samples/node-hello:1.0</span></span><br><span class="line"><span class="attr">    env:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">DEMO_GREETING</span></span><br><span class="line"><span class="attr">      value:</span> <span class="string">"Hello from the environment"</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">DEMO_FAREWELL</span></span><br><span class="line"><span class="attr">      value:</span> <span class="string">"Such a sweet sorrow"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="在配置中使用环境变量"><a href="#在配置中使用环境变量" class="headerlink" title="在配置中使用环境变量"></a>在配置中使用环境变量</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">print-greeting</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">env-print-demo</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">bash</span></span><br><span class="line"><span class="attr">    env:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">GREETING</span></span><br><span class="line"><span class="attr">      value:</span> <span class="string">"Warm greetings to"</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">HONORIFIC</span></span><br><span class="line"><span class="attr">      value:</span> <span class="string">"The Most Honorable"</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">NAME</span></span><br><span class="line"><span class="attr">      value:</span> <span class="string">"Kubernetes"</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">["echo"]</span></span><br><span class="line"><span class="attr">    args:</span> <span class="string">["$(GREETING)</span> <span class="string">$(HONORIFIC)</span> <span class="string">$(NAME)"]</span></span><br></pre></td></tr></table></figure>
<h3 id="通过环境变量将Pod信息暴露给容器"><a href="#通过环境变量将Pod信息暴露给容器" class="headerlink" title="通过环境变量将Pod信息暴露给容器"></a>通过环境变量将Pod信息暴露给容器</h3><h4 id="有两种方法可以将Pod和Container字段公开给正在运行的Container："><a href="#有两种方法可以将Pod和Container字段公开给正在运行的Container：" class="headerlink" title="有两种方法可以将Pod和Container字段公开给正在运行的Container："></a>有两种方法可以将Pod和Container字段公开给正在运行的Container：</h4><p>1、环境变量</p>
<p>2、DownwardAPIVolumeFiles</p>
<p>这两种暴露Pod和Container字段的方式一起称为 Downward API。</p>
<p>参考：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">dapi-envars-fieldref</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">test-container</span></span><br><span class="line"><span class="attr">      image:</span> <span class="string">k8s.gcr.io/busybox</span></span><br><span class="line"><span class="attr">      command:</span> <span class="string">[</span> <span class="string">"sh"</span><span class="string">,</span> <span class="string">"-c"</span><span class="string">]</span></span><br><span class="line"><span class="attr">      args:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">while</span> <span class="literal">true</span><span class="string">;</span> <span class="string">do</span></span><br><span class="line">          <span class="string">echo</span> <span class="bullet">-en</span> <span class="string">'\n'</span><span class="string">;</span></span><br><span class="line">          <span class="string">printenv</span> <span class="string">MY_NODE_NAME</span> <span class="string">MY_POD_NAME</span> <span class="string">MY_POD_NAMESPACE;</span></span><br><span class="line">          <span class="string">printenv</span> <span class="string">MY_POD_IP</span> <span class="string">MY_POD_SERVICE_ACCOUNT;</span></span><br><span class="line">          <span class="string">sleep</span> <span class="number">10</span><span class="string">;</span></span><br><span class="line">        <span class="string">done;</span></span><br><span class="line"><span class="attr">      env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">MY_NODE_NAME</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">spec.nodeName</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">MY_POD_NAME</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">MY_POD_NAMESPACE</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">MY_POD_IP</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">MY_POD_SERVICE_ACCOUNT</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">spec.serviceAccountName</span></span><br><span class="line"><span class="attr">  restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure></p>
<h4 id="通过文件mount的形式将pod-信息暴露给container"><a href="#通过文件mount的形式将pod-信息暴露给container" class="headerlink" title="通过文件mount的形式将pod  信息暴露给container"></a>通过文件mount的形式将pod  信息暴露给container</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubernetes-downwardapi-volume-example</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    zone:</span> <span class="string">us-est-coast</span></span><br><span class="line"><span class="attr">    cluster:</span> <span class="string">test-cluster1</span></span><br><span class="line"><span class="attr">    rack:</span> <span class="string">rack-22</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line"><span class="attr">    build:</span> <span class="string">two</span></span><br><span class="line"><span class="attr">    builder:</span> <span class="string">john-doe</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">client-container</span></span><br><span class="line"><span class="attr">      image:</span> <span class="string">k8s.gcr.io/busybox</span></span><br><span class="line"><span class="attr">      command:</span> <span class="string">["sh",</span> <span class="string">"-c"</span><span class="string">]</span></span><br><span class="line"><span class="attr">      args:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">while</span> <span class="literal">true</span><span class="string">;</span> <span class="string">do</span></span><br><span class="line">          <span class="string">if</span> <span class="string">[[</span> <span class="bullet">-e</span> <span class="string">/etc/podinfo/labels</span> <span class="string">]];</span> <span class="string">then</span></span><br><span class="line">            <span class="string">echo</span> <span class="bullet">-en</span> <span class="string">'\n\n'</span><span class="string">;</span> <span class="string">cat</span> <span class="string">/etc/podinfo/labels;</span> <span class="string">fi;</span></span><br><span class="line">          <span class="string">if</span> <span class="string">[[</span> <span class="bullet">-e</span> <span class="string">/etc/podinfo/annotations</span> <span class="string">]];</span> <span class="string">then</span></span><br><span class="line">            <span class="string">echo</span> <span class="bullet">-en</span> <span class="string">'\n\n'</span><span class="string">;</span> <span class="string">cat</span> <span class="string">/etc/podinfo/annotations;</span> <span class="string">fi;</span></span><br><span class="line">          <span class="string">sleep</span> <span class="number">5</span><span class="string">;</span></span><br><span class="line">        <span class="string">done;</span></span><br><span class="line"><span class="attr">      volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">podinfo</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/podinfo</span></span><br><span class="line"><span class="attr">          readOnly:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  volumes:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">podinfo</span></span><br><span class="line"><span class="attr">      downwardAPI:</span></span><br><span class="line"><span class="attr">        items:</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">"labels"</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.labels</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">"annotations"</span></span><br><span class="line"><span class="attr">            fieldRef:</span></span><br><span class="line"><span class="attr">              fieldPath:</span> <span class="string">metadata.annotations</span></span><br></pre></td></tr></table></figure>
<h3 id="使用secrets安全地注入数据到container"><a href="#使用secrets安全地注入数据到container" class="headerlink" title="使用secrets安全地注入数据到container"></a>使用secrets安全地注入数据到container</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret generic my-secret --from-literal=username=username --from-literal=password=12345</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line"><span class="attr">  password:</span> <span class="string">MTIzNDU=</span></span><br><span class="line"><span class="attr">  username:</span> <span class="string">dXNlcm5hbWU=</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">my-secret</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">secret-test-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">test-container</span></span><br><span class="line"><span class="attr">      image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">      volumeMounts:</span></span><br><span class="line">        <span class="comment"># name must match the volume name below</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">secret-volume</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/secret-volume</span></span><br><span class="line">  <span class="comment"># The secret data is exposed to Containers in the Pod through a Volume.</span></span><br><span class="line"><span class="attr">  volumes:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">secret-volume</span></span><br><span class="line"><span class="attr">      secret:</span></span><br><span class="line"><span class="attr">        secretName:</span> <span class="string">my-secret</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">envvars-multiple-secrets</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">envars-test-container</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">    env:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">DB_PASSWORD</span></span><br><span class="line"><span class="attr">      valueFrom:</span></span><br><span class="line"><span class="attr">        secretKeyRef:</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">my-secret</span></span><br><span class="line"><span class="attr">          key:</span> <span class="string">password</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">DB_USERNAME</span></span><br><span class="line"><span class="attr">      valueFrom:</span></span><br><span class="line"><span class="attr">        secretKeyRef:</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">my-secret</span></span><br><span class="line"><span class="attr">          key:</span> <span class="string">username</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">envvars-multiple-secrets</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">envars-test-container</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">    envFrom:</span></span><br><span class="line"><span class="attr">      secretRef:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">my-secret</span></span><br></pre></td></tr></table></figure>
<p>参考：<a href="https://kubernetes.io/docs/tasks/inject-data-application/distribute-credentials-secure/" target="_blank" rel="noopener">https://kubernetes.io/docs/tasks/inject-data-application/distribute-credentials-secure/</a></p>
<h3 id="使用PodPreset将信息注入Pod"><a href="#使用PodPreset将信息注入Pod" class="headerlink" title="使用PodPreset将信息注入Pod"></a>使用PodPreset将信息注入Pod</h3><p>参考：<br><a href="https://kubernetes.io/docs/tasks/inject-data-application/podpreset/" target="_blank" rel="noopener">https://kubernetes.io/docs/tasks/inject-data-application/podpreset/</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kubernetes/">kubernetes</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-Access-Clusters-Using-the-Kubernetes-API"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2019/08/03/Access-Clusters-Using-the-Kubernetes-API/">使用Kubernetes API访问群集</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2019/08/03/Access-Clusters-Using-the-Kubernetes-API/" class="article-date">
	  <time datetime="2019-08-03T02:32:31.000Z" itemprop="datePublished">August 3, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="使用kubectl-proxy"><a href="#使用kubectl-proxy" class="headerlink" title="使用kubectl proxy"></a>使用kubectl proxy</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl proxy --port 8080 &amp;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:8080/api</span><br></pre></td></tr></table></figure>
<p>输出类似于<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;kind&quot;: &quot;APIVersions&quot;,</span><br><span class="line">  &quot;versions&quot;: [</span><br><span class="line">    &quot;v1&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;serverAddressByClientCIDRs&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;clientCIDR&quot;: &quot;0.0.0.0/0&quot;,</span><br><span class="line">      &quot;serverAddress&quot;: &quot;192.168.1.191:6443&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>获取pod的列表：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:8080/api/v1/namespaces/default/pods</span><br></pre></td></tr></table></figure></p>
<h3 id="不通过kubectl-proxy"><a href="#不通过kubectl-proxy" class="headerlink" title="不通过kubectl proxy"></a>不通过kubectl proxy</h3><p>通过将身份验证令牌直接传递给API服务器，可以避免使用kubectl代理，如下所示</p>
<h3 id="使用grep-cut方法："><a href="#使用grep-cut方法：" class="headerlink" title="使用grep/cut方法："></a>使用grep/cut方法：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config view -o jsonpath=<span class="string">'&#123;"Cluster name\tServer\n"&#125;&#123;range .clusters[*]&#125;&#123;.name&#125;&#123;"\t"&#125;&#123;.cluster.server&#125;&#123;"\n"&#125;&#123;end&#125;'</span></span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cluster name	Server</span><br><span class="line">kubernetes	https://dev-7:6443</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> CLUSTER_NAME=<span class="string">"kubernetes"</span></span><br><span class="line"><span class="built_in">export</span> APISERVER=$(kubectl config view -o jsonpath=<span class="string">"&#123;.clusters[?(@.name==\"<span class="variable">$&#123;CLUSTER_NAME&#125;</span>\")].cluster.server&#125;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Gets the token value</span></span><br><span class="line"><span class="comment">## linux</span></span><br><span class="line"><span class="built_in">export</span> TOKEN=$(kubectl get secrets -o jsonpath=<span class="string">"&#123;.items[?(@.metadata.annotations['kubernetes\.io/service-account\.name']=='default')].data.token&#125;"</span>|base64 -d)</span><br><span class="line"><span class="comment">## mac</span></span><br><span class="line"><span class="built_in">export</span> TOKEN=$(kubectl get secrets -o jsonpath=<span class="string">"&#123;.items[?(@.metadata.annotations['kubernetes\.io/service-account\.name']=='default')].data.token&#125;"</span>|base64 -D)</span><br><span class="line"></span><br><span class="line">curl -X GET <span class="variable">$&#123;APISERVER&#125;</span>/api --header <span class="string">"Authorization: Bearer <span class="variable">$&#123;TOKEN&#125;</span>"</span> --insecure</span><br></pre></td></tr></table></figure>
<h4 id="使用jsonpath方法："><a href="#使用jsonpath方法：" class="headerlink" title="使用jsonpath方法："></a>使用jsonpath方法：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> APISERVER=$(kubectl config view --minify -o jsonpath=<span class="string">'&#123;.clusters[0].cluster.server&#125;'</span>)</span><br><span class="line"><span class="built_in">export</span> TOKEN=$(kubectl get secret $(kubectl get serviceaccount default -o jsonpath=<span class="string">'&#123;.secrets[0].name&#125;'</span>) -o jsonpath=<span class="string">'&#123;.data.token&#125;'</span> | base64 --decode )</span><br><span class="line">curl <span class="variable">$&#123;APISERVER&#125;</span>/api --header <span class="string">"Authorization: Bearer <span class="variable">$&#123;TOKEN&#125;</span>"</span> --insecure</span><br></pre></td></tr></table></figure>
<h3 id="使用client-go编程的方式来访问"><a href="#使用client-go编程的方式来访问" class="headerlink" title="使用client-go编程的方式来访问"></a>使用client-go编程的方式来访问</h3><p>参考:<a href="https://github.com/kubernetes/client-go" target="_blank" rel="noopener">https://github.com/kubernetes/client-go</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import (</span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">   <span class="string">"k8s.io/client-go/1.4/kubernetes"</span></span><br><span class="line">   <span class="string">"k8s.io/client-go/1.4/pkg/api/v1"</span></span><br><span class="line">   <span class="string">"k8s.io/client-go/1.4/tools/clientcmd"</span></span><br><span class="line">)</span><br><span class="line">...</span><br><span class="line">   // uses the current context <span class="keyword">in</span> kubeconfig</span><br><span class="line">   config, _ := clientcmd.BuildConfigFromFlags(<span class="string">""</span>, <span class="string">"path to kubeconfig"</span>)</span><br><span class="line">   // creates the clientset</span><br><span class="line">   clientset, _:= kubernetes.NewForConfig(config)</span><br><span class="line">   // access the API to list pods</span><br><span class="line">   pods, _:= clientset.CoreV1().Pods(<span class="string">""</span>).List(v1.ListOptions&#123;&#125;)</span><br><span class="line">   fmt.Printf(<span class="string">"There are %d pods in the cluster\n"</span>, len(pods.Items))</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>参考： <a href="https://kubernetes.io/docs/tasks/administer-cluster/access-cluster-api/" target="_blank" rel="noopener">https://kubernetes.io/docs/tasks/administer-cluster/access-cluster-api/</a></p>
<p>export CLUSTER_NAME=”kubernetes”<br>export APISERVER=$(kubectl config view -o jsonpath=”{.clusters[?(@.name==\”${CLUSTER_NAME}\”)].cluster.server}”)<br>token=$(echo $(kubectl get secrets  wisecloud-agent-token-r56r2 -n wisecloud-agent -o jsonpath=”{.data.token}”)|base64 -d)<br>curl -X GET ${APISERVER}/api/v1/namespaces/default/pods –header “Authorization: Bearer ${token}” –insecure</p>
<p>kubectl create sa wp -n wisecloud-agent<br>kubectl edit  clusterrolebinding wisecloud-controller -n wisecloud-agent </p>
<p>kubectl edit ds ingress-agent -n  wisecloud-agent </p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kubernetes/">kubernetes</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-dockerfile"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2019/07/20/dockerfile/">dockerfile编写文档</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2019/07/20/dockerfile/" class="article-date">
	  <time datetime="2019-07-20T03:21:52.000Z" itemprop="datePublished">July 20, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">官方文档</a></p>
<p><a href="https://mp.weixin.qq.com/s/pnrWO65OFpq3OlVTKylVtw" target="_blank" rel="noopener">优化Docker镜像，加速应用部署，教你6个小窍门</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-tmux"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2019/07/20/tmux/">Tmux常用快捷键以及我会常到的一些问题汇总</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2019/07/20/tmux/" class="article-date">
	  <time datetime="2019-07-20T02:45:53.000Z" itemprop="datePublished">July 20, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">tmux</span> <span class="string">new</span>　　<span class="string">创建默认名称的会话（在tmux命令模式使用new命令可实现同样的功能，其他命令同理，后文不再列出tmux终端命令）</span></span><br><span class="line"></span><br><span class="line"><span class="string">tmux</span> <span class="string">new</span> <span class="bullet">-s</span> <span class="string">mysession</span>　　<span class="string">创建名为mysession的会话</span></span><br><span class="line"></span><br><span class="line"><span class="string">tmux</span> <span class="string">ls</span>　　<span class="string">显示会话列表</span></span><br><span class="line"></span><br><span class="line"><span class="string">tmux</span> <span class="string">a</span>　　<span class="string">连接上一个会话</span></span><br><span class="line"></span><br><span class="line"><span class="string">tmux</span> <span class="string">a</span> <span class="bullet">-t</span> <span class="string">mysession</span>　　<span class="string">连接指定会话</span></span><br><span class="line"></span><br><span class="line"><span class="string">tmux</span> <span class="string">rename</span> <span class="bullet">-t</span> <span class="string">s1</span> <span class="string">s2</span>　　<span class="string">重命名会话s1为s2</span></span><br><span class="line"></span><br><span class="line"><span class="string">tmux</span> <span class="string">kill-session</span>　　<span class="string">关闭上次打开的会话</span></span><br><span class="line"></span><br><span class="line"><span class="string">tmux</span> <span class="string">kill-session</span> <span class="bullet">-t</span> <span class="string">s1</span>　　<span class="string">关闭会话s1</span></span><br><span class="line"></span><br><span class="line"><span class="string">tmux</span> <span class="string">kill-session</span> <span class="bullet">-a</span> <span class="bullet">-t</span> <span class="string">s1</span>　　<span class="string">关闭除s1外的所有会话</span></span><br><span class="line"></span><br><span class="line"><span class="string">tmux</span> <span class="string">kill-server</span>　　<span class="string">关闭所有会话</span></span><br></pre></td></tr></table></figure>
<p><a href="https://blog.csdn.net/samjjx/article/details/54835804" target="_blank" rel="noopener">tmux 批量操作</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctrl+b 以后输入</span><br><span class="line">:set synchronize-panes</span><br></pre></td></tr></table></figure></p>
<h2 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h2><p><a href="https://www.cnblogs.com/piperck/p/4992159.html" target="_blank" rel="noopener">https://www.cnblogs.com/piperck/p/4992159.html</a><br><a href="https://www.cnblogs.com/ifantastic/p/4647523.html" target="_blank" rel="noopener">https://www.cnblogs.com/ifantastic/p/4647523.html</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-makefile"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2019/07/19/makefile/">makefile相关资料</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2019/07/19/makefile/" class="article-date">
	  <time datetime="2019-07-19T07:45:18.000Z" itemprop="datePublished">July 19, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Makefile旅行"><a href="#Makefile旅行" class="headerlink" title="Makefile旅行"></a>Makefile旅行</h2><p><a href="http://makefiletutorial.com/" target="_blank" rel="noopener">http://makefiletutorial.com/</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/makefile/">makefile</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-golang占位符"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2019/07/19/golang占位符/">golang中的格式化输入输出</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2019/07/19/golang占位符/" class="article-date">
	  <time datetime="2019-07-19T07:23:02.000Z" itemprop="datePublished">July 19, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>简介】</p>
<p>　　fmt 包实现了格式化 I/O 函数，类似于 C 的 printf 和 scanf。格式“占位符”衍生自 C，但比 C 更简单。</p>
<p>【打印】</p>
<p>占位符：</p>
<p>[一般]</p>
<p>　　%v    相应值的默认格式。在打印结构体时，“加号”标记（%+v）会添加字段名</p>
<p>　　%#v    相应值的 Go 语法表示</p>
<p>　　%T    相应值的类型的 Go 语法表示</p>
<p>　　%%    字面上的百分号，并非值的占位符</p>
<p>[布尔]</p>
<p>　　%t    单词 true 或 false。</p>
<p>[整数]</p>
<p>　　%b    二进制表示</p>
<p>　　%c    相应 Unicode 码点所表示的字符</p>
<p>　　%d    十进制表示</p>
<p>　　%o    八进制表示</p>
<p>　　%q    单引号围绕的字符字面值，由 Go 语法安全地转义</p>
<p>　　%x    十六进制表示，字母形式为小写 a-f</p>
<p>　　%X    十六进制表示，字母形式为大写 A-F</p>
<p>　　%U    Unicode 格式：U+1234，等同于 “U+%04X”</p>
<p>[浮点数及其复合构成]</p>
<p>　　%b    无小数部分的，指数为二的幂的科学计数法，与 strconv.FormatFloat 的 ‘b’ 转换格式一致。例如 -123456p-78</p>
<p>　　%e    科学计数法，例如 -1234.456e+78</p>
<p>　　%E    科学计数法，例如 -1234.456E+78</p>
<p>　　%f    有小数点而无指数，例如 123.456</p>
<p>　　%g    根据情况选择 %e 或 %f 以产生更紧凑的（无末尾的 0）输出</p>
<p>　　%G    根据情况选择 %E 或 %f 以产生更紧凑的（无末尾的 0）输出</p>
<p>[字符串与字节切片]</p>
<p>　　%s    字符串或切片的无解译字节</p>
<p>　　%q    双引号围绕的字符串，由 Go 语法安全地转义</p>
<p>　　%x    十六进制，小写字母，每字节两个字符</p>
<p>　　%X    十六进制，大写字母，每字节两个字符</p>
<p>[指针]</p>
<p>　　%p    十六进制表示，前缀 0x</p>
<p>[注意]</p>
<p>　　这里没有 ‘u’ 标记。若整数为无符号类型，他们就会被打印成无符号的。类似地， 这里也不需要指定操作数的大小（int8，int64）。</p>
<p>　　宽度与精度的控制格式以 Unicode 码点为单位。（这点与 C 的 printf 不同， 它以字节数为单位。）二者或其中之一均可用字符 ‘*’ 表示， 此时它们的值会从下一个操作数中获取，该操作数的类型必须为 int。</p>
<p>// 宽度与精度的控制以 Unicode 码点为单位<br>fmt.Printf(“\”%8s\”\n”, “123456”) // 最大长度为 8<br>// “  123456”<br>fmt.Printf(“\”%8s\”\n”, “你好”)   // 最大长度为 8<br>// “      你好”</p>
<p>// 宽度与精度均可用字符 ‘<em>‘ 表示<br>fmt.Printf(“%0</em>.*f \n”, 8, 3, 13.25) // 总长度 8，小数位数 3<br>fmt.Printf(“%08.3f \n”, 13.25)       // 总长度 8，小数位数 3<br>// 0013.250</p>
<p>　　对数值而言，宽度为该数值占用区域的最小宽度；精度为小数点之后的位数。 但对于 %g/%G 而言，精度为所有数字的总数。例如，对于 123.45，格式 %6.2f 会打印 123.45，而 %.4g 会打印 123.5。%e 和 %f 的默认精度为 6；但对于 %g 而言，它的默认精度为确定该值所必须的最小位数。</p>
<p>　　对大多数值而言，宽度为输出的最小字符数，如果必要的话会为已格式化的形式填充空格。对字符串而言，精度为输出的最大字符数，如果必要的话会直接截断。</p>
<p>// 宽度与精度标记字符串<br>fmt.Printf(“%8q”, “ABC”)         // 最小长度为 8（包括 %q 的引号字符）<br>//    “ABC”<br>fmt.Printf(“%.8q”, “1234567890”) // 最大长度为 8（不包括 %q 的引号字符）<br>// “12345678”</p>
<p>[其它标记]</p>
<p>　　+    总打印数值的正负号；对于 %q（%+q）保证只输出 ASCII 编码的字符。</p>
<p>　　-    在右侧而非左侧填充空格（左对齐该区域）</p>
<p>　　#    备用格式：为八进制添加前导 0（%#o），为十六进制添加前导 0x（%#x）或</p>
<p>　　0X（%#X），为 %p（%#p）去掉前导 0x；如果可能的话，%q（%#q）会打印原始（即反引号围绕的）字符串；如果是可打印字符，%U（%#U）会写出该字符的 Unicode 编码形式（如字符 x 会被打印成 U+0078 ‘x’）。</p>
<p>　　‘ ‘    （空格）为数值中省略的正负号留出空白（% d）；以十六进制（% x, % X）打印字符串或切片时，在字节之间用空格隔开：</p>
<p>fmt.Printf(“% x\n”, “Hello”)<br>// 48 65 6c 6c 6f</p>
<p>　　0    填充前导的 0 而非空格；对于数字，这会将填充移到正负号之后</p>
<p>[注意]</p>
<p>　　标记有时会被占位符忽略，所以不要指望它们。例如十进制没有备用格式，因此 %#d 与 %d 的行为相同。</p>
<p>　　对于每一个 Printf 类的函数，都有一个 Print 函数，该函数不接受任何格式化， 它等价于对每一个操作数都应用 %v。另一个变参函数 Println 会在操作数之间插入空白， 并在末尾追加一个换行符。</p>
<p>　　不考虑占位符的话，如果操作数是接口值，就会使用其内部的具体值，而非接口本身。 因此：</p>
<p>var i interface{} = 23<br>fmt.Printf(“%v\n”, i)<br>// 会打印 23</p>
<p>　　若一个操作数实现了 Formatter 接口，该接口就能更好地用于控制格式化。</p>
<p>　　若其格式（它对于 Println 等函数是隐式的 %v）对于字符串是有效的（%s %q %v %x %X），以下两条规则也适用：</p>
<p>　　1、若一个操作数实现了 error 接口，Error 方法就能将该对象转换为字符串，随后会根据占位符的需要进行格式化。</p>
<p>　　2、若一个操作数实现了 String() string 方法，该方法能将该对象转换为字符串，随后会根据占位符的需要进行格式化。</p>
<p>　　为避免以下这类递归的情况：</p>
<p>　　type X string<br>　　func (x X) String() string { return Sprintf(“&lt;%s&gt;”, x) }</p>
<p>　　需要在递归前转换该值：<br>　　func (x X) String() string { return Sprintf(“&lt;%s&gt;”, string(x)) }</p>
<p>[格式化错误]</p>
<p>　　如果给占位符提供了无效的实参（例如将一个字符串提供给 %d），所生成的字符串会包含该问题的描述，如下例所示：</p>
<p>　　类型错误或占位符未知：%!verb(type=value)</p>
<p>Printf(“%d”, hi)<br>// %!d(string=hi)</p>
<p>　　实参太多：%!(EXTRA type=value)</p>
<p>Printf(“hi”, “guys”)<br>// hi%!(EXTRA string=guys)</p>
<p>　　实参太少：%!verb(MISSING)</p>
<p>Printf(“hi%d”)<br>// hi %!d(MISSING)</p>
<p>　　宽度或精度不是 int 类型：%!(BADWIDTH）或 %!(BADPREC)</p>
<p>Printf(“%*s”, 4.5, “hi”)<br>// %!(BADWIDTH)hi</p>
<p>Printf(“%.*s”, 4.5, “hi”)<br>// %!(BADPREC)hi</p>
<p>　　所有错误都始于“%!”，有时紧跟着单个字符（占位符），并以小括号括住的描述结尾。</p>
<p>【扫描】</p>
<p>　　一组类似的函数通过扫描已格式化的文本来产生值。Scan、Scanf 和 Scanln 从 os.Stdin 中读取；Fscan、Fscanf 和 Fscanln 从指定的 io.Reader 中读取； Sscan、Sscanf 和 Sscanln 从实参字符串中读取。Scanln、Fscanln 和 Sscanln 在换行符处停止扫描，且需要条目紧随换行符之后；Scanf、Fscanf 和 Sscanf 需要输入换行符来匹配格式中的换行符；其它函数则将换行符视为空格。</p>
<p>　　Scanf、Fscanf 和 Sscanf 根据格式字符串解析实参，类似于 Printf。例如，%x 会将一个整数扫描为十六进制数，而 %v 则会扫描该值的默认表现格式。</p>
<p>　　格式化行为类似于 Printf，但也有如下例外：</p>
<p>　　%p 没有实现<br>　　%T 没有实现<br>　　%e %E %f %F %g %G 都完全等价，且可扫描任何浮点数或复合数值<br>　　%s 和 %v 在扫描字符串时会将其中的空格作为分隔符<br>　　标记 # 和 + 没有实现</p>
<p>　　在使用 %v 占位符扫描整数时，可接受友好的进制前缀 0（八进制）和 0x（十六进制）。</p>
<p>　　宽度被解释为输入的文本（%5s 意为最多从输入中读取 5 个符文来扫描成字符串），而扫描函数则没有精度的语法（没有 %5.2f，只有 %5f）。</p>
<p>　　当以某种格式进行扫描时，无论在格式中还是在输入中，所有非空的连续空白字符 （除换行符外）都等价于单个空格。由于这种限制，格式字符串文本必须匹配输入的文本，如果不匹配，扫描过程就会停止，并返回已扫描的实参数。</p>
<p>　　在所有的扫描参数中，若一个操作数实现了 Scan 方法（即它实现了 Scanner 接口），该操作数将使用该方法扫描其文本。此外，若已扫描的实参数少于所提供的实参数，就会返回一个错误。</p>
<p>　　所有需要被扫描的实参都必须是基本类型或实现了 Scanner 接口的类型。</p>
<p>　　注意：Fscan 等函数会从输入中多读取一个字符（符文），因此，如果循环调用扫描函数，可能会跳过输入中的某些数据。一般只有在输入的数据中没有空白符时该问题才会出现。若提供给 Fscan 的读取器实现了 ReadRune，就会用该方法读取字符。若此读取器还实现了 UnreadRune 方法，就会用该方法保存字符，而连续的调用将不会丢失数据。若要为没有 ReadRune 和 UnreadRune 方法的读取器加上这些功能，需使用 bufio.NewReader。</p>
<p>转载：<a href="https://blog.csdn.net/xiaoyida11/article/details/51554022" target="_blank" rel="noopener">https://blog.csdn.net/xiaoyida11/article/details/51554022</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/">golang</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-pvc-pv"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2019/07/02/pvc-pv/">kubernetes 创建 pvc-pv</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2019/07/02/pvc-pv/" class="article-date">
	  <time datetime="2019-07-02T02:18:31.000Z" itemprop="datePublished">July 2, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>pv.yaml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolume</span><br><span class="line">metadata:</span><br><span class="line">    name: pv0003</span><br><span class="line">spec:</span><br><span class="line">    capacity:</span><br><span class="line">      storage: 5Gi</span><br><span class="line">    accessModes:</span><br><span class="line">      - ReadWriteOnce</span><br><span class="line">    persistentVolumeReclaimPolicy: Recycle</span><br><span class="line">    nfs:</span><br><span class="line">      path: /k8s/weblogic</span><br><span class="line">      server: 192.168.0.103</span><br></pre></td></tr></table></figure></p>
<p>pvc.yaml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: weblogiclogs</span><br><span class="line">spec:</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 5Gi</span><br></pre></td></tr></table></figure></p>
<p>创建<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f pv.yaml -f pvc.yaml</span><br></pre></td></tr></table></figure></p>
<p>查看创建之后的,发现pv已经被bound<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl  get pv</span><br><span class="line">NAME                                 CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS     CLAIM            </span><br><span class="line">pv0003                               5Gi        RWO            Recycle          Bound      default/weblogiclogs</span><br><span class="line"></span><br><span class="line">kubectl get pvc</span><br><span class="line">NAME           STATUS    VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">weblogiclogs   Bound     pv0003    5Gi        RWO                           9m</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kubernetes/">kubernetes</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-golang"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2019/06/28/golang/">golang相关资料</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2019/06/28/golang/" class="article-date">
	  <time datetime="2019-06-28T06:47:23.000Z" itemprop="datePublished">June 28, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Go语言高级编程-Advanced-Go-Programming"><a href="#Go语言高级编程-Advanced-Go-Programming" class="headerlink" title="Go语言高级编程(Advanced Go Programming)"></a>Go语言高级编程(Advanced Go Programming)</h2><p><a href="https://chai2010.cn/advanced-go-programming-book/" target="_blank" rel="noopener">https://chai2010.cn/advanced-go-programming-book/</a><br><a href="https://github.com/golang/go/wiki" target="_blank" rel="noopener">https://github.com/golang/go/wiki</a></p>
<h2 id="golang-官方编码规范"><a href="#golang-官方编码规范" class="headerlink" title="golang 官方编码规范"></a>golang 官方编码规范</h2><p><a href="https://github.com/golang/go/wiki/CodeReviewComments" target="_blank" rel="noopener">https://github.com/golang/go/wiki/CodeReviewComments</a><br><a href="https://golang.org/doc/effective_go.html" target="_blank" rel="noopener">https://golang.org/doc/effective_go.html</a></p>
<h2 id="golang-同步原语与锁"><a href="#golang-同步原语与锁" class="headerlink" title="golang 同步原语与锁"></a><a href="https://draveness.me/golang/concurrency/golang-sync-primitives.html" target="_blank" rel="noopener">golang 同步原语与锁</a></h2><h2 id="Go内存分配那些事，就这么简单！"><a href="#Go内存分配那些事，就这么简单！" class="headerlink" title="Go内存分配那些事，就这么简单！"></a>Go内存分配那些事，就这么简单！</h2><p><a href="https://mp.weixin.qq.com/s/3gGbJaeuvx4klqcv34hmmw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/3gGbJaeuvx4klqcv34hmmw</a><br><a href="https://github.com/WilburXu/blog/blob/master/Golang/Go%20%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90.md" target="_blank" rel="noopener">https://github.com/WilburXu/blog/blob/master/Golang/Go%20%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90.md</a></p>
<h2 id="大量的数据使用gob"><a href="#大量的数据使用gob" class="headerlink" title="大量的数据使用gob"></a><a href="https://blog.golang.org/gobs-of-data" target="_blank" rel="noopener">大量的数据使用gob</a></h2><h2 id="深入Go的异常错误处理机制"><a href="#深入Go的异常错误处理机制" class="headerlink" title="深入Go的异常错误处理机制"></a><a href="https://gocn.vip/article/1882" target="_blank" rel="noopener">深入Go的异常错误处理机制</a></h2><h2 id="深度解密Go语言之关于-interface-的-10-个问题"><a href="#深度解密Go语言之关于-interface-的-10-个问题" class="headerlink" title="深度解密Go语言之关于 interface 的 10 个问题"></a><a href="https://mp.weixin.qq.com/s/JC-pmnNt7ztRbw5t3qDjvA" target="_blank" rel="noopener">深度解密Go语言之关于 interface 的 10 个问题</a></h2>
      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/">golang</a></li></ul>

      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  
    <article id="post-webhook"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2019/06/28/webhook/">Kubernetes中的Admission Controller webhook</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2019/06/28/webhook/" class="article-date">
	  <time datetime="2019-06-28T06:39:47.000Z" itemprop="datePublished">June 28, 2019</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Kubernetes中的Admission-Controller是做什么的呢？有什么用呢？怎么自己定义一个呢？"><a href="#Kubernetes中的Admission-Controller是做什么的呢？有什么用呢？怎么自己定义一个呢？" class="headerlink" title="Kubernetes中的Admission Controller是做什么的呢？有什么用呢？怎么自己定义一个呢？"></a>Kubernetes中的Admission Controller是做什么的呢？有什么用呢？怎么自己定义一个呢？</h1><h2 id="Q-什么是Admission-Controller"><a href="#Q-什么是Admission-Controller" class="headerlink" title="Q: 什么是Admission Controller?"></a>Q: 什么是Admission Controller?</h2><p>A: 官方定义：</p>
<p>An admission controller is a piece of code that intercepts requests to the Kubernetes API server prior to persistence of the object, but after the request is authenticated and authorized.</p>
<p>我理解的：</p>
<p>Admission Controller是一个拦截器<br>拦截发送给Kuberenetes API Server的请求<br>什么时候拦截？在请求通过认证之后，请求被存储起来之前</p>
<p>所以顺理成章，由于拦截的是发送给API Server的请求，所以Admission Controller存在于API Server内部，即compiled into the kube-apiserver binary（被编译进API Server的可执行文件里）。<br>kubernetes将AC分为三种：</p>
<p>validating，验证型。用于验证k8s的资源定义是否符合规则<br>mutating，修改型。用于修改k8s的资源定义，比如加个label什么的<br>二者皆是，即同一个AC，既是验证型又是修改型</p>
<p>多个Admission Controller会形成一个Admission Chain（链条），修改型的在前面先执行，验证型的在后面后执行，这样验证型的才能去验证修改的对不对。<br>K: interceptor, validating, mutating, Admission Chain<br>Q: Admission Controller有什么用？<br>A: API Server内置了一些AC，有各种各样的作用[1]。比如：</p>
<p>EventRateLimit，用于限制事件的频率<br>LimitRanger，验证所有的请求都没有超出namespace中定义的LimitRange</p>
<p>还有很多其他AC，具体请参考Kubernetes文档。<br>这些AC中，有两个对用户来说比较有用：</p>
<p>MutatingAdmissionWebhook，这是一个webhook，即网络钩子，也就是说该AC会去请求服务端，并执行相应的逻辑<br>ValidatingAdmissionWebhook，也是一个webhook，只是用于验证</p>
<p>Q: 怎么查看哪些AC是打开了的？<br>A: 文档上写的用：kube-apiserver -h | grep enable-admission-plugins。但是由于本地是minikube，进入虚拟机之后并没有发现kube-apiserver命令。<br>后来发现api-server是以pod的形式运行的：<br>kubectl get pods -n kube-system</p>
<p>于是，使用kubectl exec登入pod，然后调用上述的指令，其结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kube-apiserver -h | grep enable-admission-plugins</span><br><span class="line">      --admission-control strings              Admission is divided into two phases. In the first phase, only mutating admission plugins run. In the second phase, only validating admission plugins run. The names in the below list may represent a validating plugin, a mutating plugin, or both. The order of plugins in which they are passed to this flag does not matter. Comma-delimited list of: AlwaysAdmit, AlwaysDeny, AlwaysPullImages, DefaultStorageClass, DefaultTolerationSeconds, DenyEscalatingExec, DenyExecOnPrivileged, EventRateLimit, ExtendedResourceToleration, ImagePolicyWebhook, Initializers, LimitPodHardAntiAffinityTopology, LimitRanger, MutatingAdmissionWebhook, NamespaceAutoProvision, NamespaceExists, NamespaceLifecycle, NodeRestriction, OwnerReferencesPermissionEnforcement, PersistentVolumeClaimResize, PersistentVolumeLabel, PodNodeSelector, PodPreset, PodSecurityPolicy, PodTolerationRestriction, Priority, ResourceQuota, SecurityContextDeny, ServiceAccount, StorageObjectInUseProtection, ValidatingAdmissionWebhook. (DEPRECATED: Use --enable-admission-plugins or --disable-admission-plugins instead. Will be removed in a future version.)</span><br><span class="line">      --enable-admission-plugins strings       admission plugins that should be enabled in addition to default enabled ones (NamespaceLifecycle, LimitRanger, ServiceAccount, Priority, DefaultTolerationSeconds, DefaultStorageClass, PersistentVolumeClaimResize, MutatingAdmissionWebhook, ValidatingAdmissionWebhook, ResourceQuota). Comma-delimited list of admission plugins: AlwaysAdmit, AlwaysDeny, AlwaysPullImages, DefaultStorageClass, DefaultTolerationSeconds, DenyEscalatingExec, DenyExecOnPrivileged, EventRateLimit, ExtendedResourceToleration, ImagePolicyWebhook, Initializers, LimitPodHardAntiAffinityTopology, LimitRanger, MutatingAdmissionWebhook, NamespaceAutoProvision, NamespaceExists, NamespaceLifecycle, NodeRestriction, OwnerReferencesPermissionEnforcement, PersistentVolumeClaimResize, PersistentVolumeLabel, PodNodeSelector, PodPreset, PodSecurityPolicy, PodTolerationRestriction, Priority, ResourceQuota, SecurityContextDeny, ServiceAccount, StorageObjectInUseProtection, ValidatingAdmissionWebhook. The order of plugins in this flag does not matter.</span><br></pre></td></tr></table></figure></p>
<h2 id="Q-Admission-webhook是啥？"><a href="#Q-Admission-webhook是啥？" class="headerlink" title="Q: Admission webhook是啥？"></a>Q: Admission webhook是啥？</h2><p>A: 官方定义：</p>
<p>Admission webhooks are HTTP callbacks that receive admission requests and do something with them.</p>
<p>简单来说webhook就是一个HTTP回调，接收admission请求，处理并返回。<br>用户可以定义两种webhook:</p>
<p>validating admission webhook<br>mutating admission webhook<br>一个用于验证，另一个用于修改。<br>webhook回调，接收API Server发送的admissionReview请求，并返回 admissionResponse。</p>
<p>K: 回调，admissionReview请求，admissionResponse返回。<br>Q: 如何配置和查看WebhookConfiguration?<br>A: 以Validating为例，查看：<br>kubectl get ValidatingWebhookConfiguration</p>
<h3 id="ValidatingWebhookConfiguration的资源定义："><a href="#ValidatingWebhookConfiguration的资源定义：" class="headerlink" title="ValidatingWebhookConfiguration的资源定义："></a>ValidatingWebhookConfiguration的资源定义：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: admissionregistration.k8s.io/v1beta1</span><br><span class="line">kind: ValidatingWebhookConfiguration</span><br><span class="line">metadata:</span><br><span class="line">  name: &lt;name of this configuration object&gt;</span><br><span class="line">webhooks:</span><br><span class="line">- name: &lt;webhook name, e.g., pod-policy.example.io&gt;</span><br><span class="line">  rules:</span><br><span class="line">  - apiGroups:</span><br><span class="line">    - &quot;&quot;</span><br><span class="line">    apiVersions:</span><br><span class="line">    - v1</span><br><span class="line">    operations:</span><br><span class="line">    - CREATE</span><br><span class="line">    resources:</span><br><span class="line">    - pods</span><br><span class="line">  clientConfig:</span><br><span class="line">    service:</span><br><span class="line">      namespace: &lt;namespace of the front-end service&gt;</span><br><span class="line">      name: &lt;name of the front-end service&gt;</span><br><span class="line">    caBundle: &lt;pem encoded ca cert that signs the server cert used by the webhook&gt;</span><br></pre></td></tr></table></figure>
<h3 id="其中rules定义了匹配规则，当发给API-Server的请求满足该规则的时候，API-Server就会给clientConfig中配置的service发送Admission请求。"><a href="#其中rules定义了匹配规则，当发给API-Server的请求满足该规则的时候，API-Server就会给clientConfig中配置的service发送Admission请求。" class="headerlink" title="其中rules定义了匹配规则，当发给API Server的请求满足该规则的时候，API Server就会给clientConfig中配置的service发送Admission请求。"></a>其中rules定义了匹配规则，当发给API Server的请求满足该规则的时候，API Server就会给clientConfig中配置的service发送Admission请求。</h3><p>使用webhook有什么要求？<br>A: 几点：</p>
<p>kubernetes版本最低是v1.9<br>api server使能（enable）了MutatingAdmissionWebhook和ValidatingAdmissionWebhook<br>admissionregistration.k8s.io/v1beta1 API处于enable状态，即使用kubectl api-versions | grep admissionregistration.k8s.io/v1beta1</p>
<p>###Q: 如何自己写一个webhook?</p>
<h3 id="A-需要完成几个事情："><a href="#A-需要完成几个事情：" class="headerlink" title="A: 需要完成几个事情："></a>A: 需要完成几个事情：</h3><p>创建TLS Certificate，即证书<br>编写服务端代码，服务端代码需要使用证书<br>根据证书创建k8s sercret<br>创建k8s Deployment和Service<br>创建k8s WebhookConfiguration，其中需要使用之前创建的证书</p>
<p>具体代码和流程参见[3]［4］<br>参考文献：<br>[1] <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/</a><br>[2] <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#admission-webhooks" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#admission-webhooks</a><br>[3] <a href="https://banzaicloud.com/blog/k8s-admission-webhooks/" target="_blank" rel="noopener">https://banzaicloud.com/blog/k8s-admission-webhooks/</a><br>[4] <a href="https://github.com/morvencao/kube-mutating-webhook-tutorial" target="_blank" rel="noopener">https://github.com/morvencao/kube-mutating-webhook-tutorial</a><br>[5] <a href="https://github.com/banzaicloud/admission-webhook-example" target="_blank" rel="noopener">https://github.com/banzaicloud/admission-webhook-example</a><br>[6] <a href="http://docs.cert-manager.io/en/latest/getting-started/webhook.html" target="_blank" rel="noopener">http://docs.cert-manager.io/en/latest/getting-started/webhook.html</a></p>
<p>作者：Mr_Hospital<br>链接：<a href="https://www.jianshu.com/p/39ae0b6fc907" target="_blank" rel="noopener">https://www.jianshu.com/p/39ae0b6fc907</a><br>来源：简书<br>简书著作权归作者所有，任何形式的转载都请联系作者获得授权并注明出处。</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
      
            
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

    

  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">Next</a>
  </nav>

</section>
          <aside id="sidebar">
  
    <div class="widget-wrap" style="margin: 20px 0;">
	<div id="search-form-wrap">

    <form class="search-form">
        <label style="width: 75%;">
            <span class="screen-reader-text">Search for:</span>
            <input type="search" class="search-field" style="height: 42px;" placeholder=" Search…" value="" name="s" title="Search for:">
        </label>
        <input type="submit" class="search-form-submit" value="Search">
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
</div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Connect With Us</h3>
    <div class="widget widget_athemes_social_icons">

    	<ul class="clearfix widget-social-icons">   
    	
          
     			  <li><a href="https://github.com/upengs" title="Github"><i class="fa fa-github" aria-hidden="true"></i></a></li> 
          
   		
          
     			  <li><a href="" title="Weibo"><i class="fa fa-weibo" aria-hidden="true"></i></a></li> 
          
   		
          
     			  <li><a href="" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a></li> 
          
   		
          
     			  <li><a href="" title="Facebook"><i class="fa fa-facebook" aria-hidden="true"></i></a></li> 
          
   		
          
     			  <li><a href="" title="Google-plus"><i class="fa fa-google-plus" aria-hidden="true"></i></a></li> 
          
   		
          
     			  <li><a href="" title="Instagram"><i class="fa fa-instagram" aria-hidden="true"></i></a></li> 
          
   		
          
     			  <li><a href="" title="Pinterest"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li> 
          
   		
          
     			  <li><a href="" title="Flickr"><i class="fa fa-flickr" aria-hidden="true"></i></a></li> 
          
   		
          
            <li><a href="mailto:1399094187@qq.com?subject=请联系我&body=我能帮你什么" title="email"><i class="fa fa-envelope" aria-hidden="true"></i></a></li> 
          
   		
   		</ul>


   		<!--
   		<ul class="clearfix widget-social-icons">   		
   		<li class="widget-si-twitter"><a href="http://twitter.com" title="Twitter"><i class="ico-twitter"></i></a></li> 
		<li class="widget-si-facebook"><a href="http://facebook.com" title="Facebook"><i class="ico-facebook"></i></a></li>
			<li class="widget-si-gplus"><a href="http://plus.google.com" title="Google+"><i class="ico-gplus"></i></a></li>
			<li class="widget-si-pinterest"><a href="http://pinterest.com" title="Pinterest"><i class="ico-pinterest"></i></a></li>
			<li class="widget-si-flickr"><a href="http://flickr.com" title="Flickr"><i class="ico-flickr"></i></a></li>
			<li class="widget-si-instagram"><a href="http://instagram.com" title="Instagram"><i class="ico-instagram"></i></a></li>
		</ul> -->

    </div>
  </div>


  
    
  <div class="widget_athemes_tabs">
    <ul id="widget-tab" class="clearfix widget-tab-nav">
      <li class="active"><a>Recent Posts</a></li>
    </ul>
    <div class="widget">
      <ul>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2019/10/10/etcdctl/">etcdctl</a></h6>
              <span>October 10, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2019/09/28/use-kubeadm-install-kubernetes/">use-kubeadm-install-kubernetes</a></h6>
              <span>September 28, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2019/09/09/Define-a-Command-and-Arguments-for-a-Container/">(no title)</a></h6>
              <span>September 9, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2019/09/07/prometheus-1/">prometheus</a></h6>
              <span>September 7, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2019/08/30/svc/">玩转kubernetes Service</a></h6>
              <span>August 30, 2019</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2019/08/19/golang-redis-分布式锁/">golang-redis-分布式锁</a></h6>
              <span>August 19, 2019</span>
            </div>

          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/helm/">helm</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/helm/kubernetes/">kubernetes</a><span class="category-list-count">1</span></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/etcd/">etcd</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/">golang</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/harbor/">harbor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/helm/">helm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernetes/">kubernetes</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/log/">log</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/makefile/">makefile</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rust/">rust</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/docker/" style="font-size: 14px;">docker</a> <a href="/tags/etcd/" style="font-size: 10px;">etcd</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/golang/" style="font-size: 16px;">golang</a> <a href="/tags/harbor/" style="font-size: 10px;">harbor</a> <a href="/tags/helm/" style="font-size: 10px;">helm</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/kubernetes/" style="font-size: 20px;">kubernetes</a> <a href="/tags/linux/" style="font-size: 18px;">linux</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/makefile/" style="font-size: 10px;">makefile</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/redis/" style="font-size: 12px;">redis</a> <a href="/tags/rust/" style="font-size: 10px;">rust</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>

    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">11</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2019 Peng All Rights Reserved.
          
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次  
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>

<!-- Custome JS -->
<script src="/js/my.js"></script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>


<script src="/js/scripts.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="https://dnqof95d40fo6.cloudfront.net/atw7f8.js">
	</script>






  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
